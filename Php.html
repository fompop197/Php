<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ระบบสื่อการสอนและผลการเรียน</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'kanit': ['Kanit', 'sans-serif'],
                    },
                    colors: {
                        primary: '#26A69A',
                        secondary: '#AED581',
                        warning: '#FFCA28',
                        danger: '#EF5350',
                        info: '#FF8A65'
                    }
                }
            }
        }
    </script>
    <style>
        body {
            box-sizing: border-box;
            font-family: 'Kanit', sans-serif;
        }
        
        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #26A69A;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            transform: translateX(400px);
            transition: transform 0.3s ease-in-out;
        }
        
        .toast.show {
            transform: translateX(0);
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        
        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .sidebar {
            transform: translateX(-100%);
            transition: transform 0.3s ease-in-out;
        }
        
        .sidebar.open {
            transform: translateX(0);
        }
        
        @media (min-width: 768px) {
            .sidebar {
                transform: translateX(0);
            }
        }
        
        .table-container {
            overflow-x: auto;
        }
        
        .badge {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.5rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        .hamburger-icon {
            display: flex;
            flex-direction: column;
            width: 20px;
            height: 16px;
            justify-content: space-between;
        }
        
        .hamburger-line {
            width: 100%;
            height: 2px;
            background-color: white;
            border-radius: 1px;
            transition: all 0.3s ease;
        }
        
        .hamburger-icon.active .hamburger-line:nth-child(1) {
            transform: rotate(45deg) translate(5px, 5px);
        }
        
        .hamburger-icon.active .hamburger-line:nth-child(2) {
            opacity: 0;
        }
        
        .hamburger-icon.active .hamburger-line:nth-child(3) {
            transform: rotate(-45deg) translate(7px, -6px);
        }
    </style>
</head>
<body class="bg-gray-50 font-kanit">
    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white p-6 rounded-lg flex items-center space-x-3">
            <div class="loading-spinner"></div>
            <span class="text-gray-700">กำลังโหลด...</span>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast bg-white border-l-4 border-primary p-4 rounded-lg shadow-lg max-w-sm">
        <div class="flex items-center">
            <i class="fas fa-check-circle text-primary mr-3"></i>
            <div>
                <p class="font-medium text-gray-800" id="toastTitle">สำเร็จ!</p>
                <p class="text-sm text-gray-600" id="toastMessage">ดำเนินการเสร็จสิ้น</p>
            </div>
        </div>
    </div>

    <!-- Login Page -->
    <div id="loginPage" class="min-h-screen bg-gradient-to-br from-primary to-secondary flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-lg p-8">
            <div class="text-center mb-8">
                <div class="w-20 h-20 bg-primary rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-graduation-cap text-white text-3xl"></i>
                </div>
                <h1 class="text-2xl font-bold text-gray-800 mb-2">ระบบสื่อการสอนและผลการเรียน</h1>
                <p class="text-gray-600">เลือกประเภทผู้ใช้และเข้าสู่ระบบ</p>
            </div>
            
            <!-- User Type Selection -->
            <div class="mb-6">
                <label class="block text-sm font-medium text-gray-700 mb-3">ประเภทผู้ใช้</label>
                <div class="grid grid-cols-3 gap-3">
                    <button type="button" onclick="selectUserType('admin')" 
                            class="user-type-btn flex flex-col items-center p-4 border-2 border-gray-200 rounded-lg hover:border-primary hover:bg-primary hover:bg-opacity-5 transition duration-200"
                            data-type="admin">
                        <i class="fas fa-user-shield text-2xl text-gray-400 mb-2"></i>
                        <span class="text-sm font-medium text-gray-700">ผู้ควบคุม</span>
                    </button>
                    <button type="button" onclick="selectUserType('teacher')" 
                            class="user-type-btn flex flex-col items-center p-4 border-2 border-gray-200 rounded-lg hover:border-primary hover:bg-primary hover:bg-opacity-5 transition duration-200"
                            data-type="teacher">
                        <i class="fas fa-chalkboard-teacher text-2xl text-gray-400 mb-2"></i>
                        <span class="text-sm font-medium text-gray-700">ครู</span>
                    </button>
                    <button type="button" onclick="selectUserType('director')" 
                            class="user-type-btn flex flex-col items-center p-4 border-2 border-gray-200 rounded-lg hover:border-primary hover:bg-primary hover:bg-opacity-5 transition duration-200"
                            data-type="director">
                        <i class="fas fa-user-tie text-2xl text-gray-400 mb-2"></i>
                        <span class="text-sm font-medium text-gray-700">ผู้อำนวยการ</span>
                    </button>
                </div>
            </div>
            
            <form id="loginForm" class="space-y-6">
                <input type="hidden" id="selectedUserType" value="">
                
                <div>
                    <label for="username" class="block text-sm font-medium text-gray-700 mb-2">ชื่อผู้ใช้</label>
                    <input type="text" id="username" name="username" required 
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"
                           placeholder="กรอกชื่อผู้ใช้">
                </div>
                
                <div>
                    <label for="password" class="block text-sm font-medium text-gray-700 mb-2">รหัสผ่าน</label>
                    <input type="password" id="password" name="password" required 
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"
                           placeholder="กรอกรหัสผ่าน">
                </div>
                
                <!-- Demo Accounts Info -->
                <div class="bg-gray-50 p-4 rounded-lg">
                    <h4 class="text-sm font-medium text-gray-700 mb-2">บัญชีทดสอบ:</h4>
                    <div class="text-xs text-gray-600 space-y-1">
                        <div><strong>ผู้ควบคุม:</strong> admin / admin123</div>
                        <div><strong>ครู:</strong> teacher1 / teacher123</div>
                        <div><strong>ผู้อำนวยการ:</strong> director1 / director123</div>
                    </div>
                </div>
                
                <button type="submit" class="w-full bg-primary text-white py-3 rounded-lg font-medium hover:bg-opacity-90 transition duration-200 disabled:opacity-50 disabled:cursor-not-allowed">
                    เข้าสู่ระบบ
                </button>
            </form>
            
            <div class="text-center mt-6">
                <a href="#" onclick="showRegisterPage()" class="text-primary hover:underline">ลงทะเบียนโรงเรียนใหม่</a>
            </div>
        </div>
    </div>

    <!-- Register Page -->
    <div id="registerPage" class="min-h-screen bg-gradient-to-br from-primary to-secondary p-4 hidden">
        <div class="max-w-4xl mx-auto">
            <div class="bg-white rounded-2xl shadow-2xl p-8">
                <div class="text-center mb-8">
                    <h1 class="text-3xl font-bold text-gray-800 mb-2">ลงทะเบียนข้อมูลโรงเรียนใหม่</h1>
                    <p class="text-gray-600">กรอกข้อมูลโรงเรียนและผู้อำนวยการ</p>
                </div>
                
                <form id="registerForm" class="grid md:grid-cols-2 gap-8">
                    <!-- ข้อมูลโรงเรียน -->
                    <div class="space-y-6">
                        <h2 class="text-xl font-semibold text-gray-800 border-b border-primary pb-2">
                            <i class="fas fa-school text-primary mr-2"></i>ข้อมูลโรงเรียน
                        </h2>
                        
                        <div>
                            <label for="schoolName" class="block text-sm font-medium text-gray-700 mb-2">ชื่อโรงเรียน</label>
                            <input type="text" id="schoolName" required 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                        </div>
                        
                        <div>
                            <label for="schoolCode" class="block text-sm font-medium text-gray-700 mb-2">รหัสโรงเรียน</label>
                            <input type="text" id="schoolCode" required 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                        </div>
                        
                        <div>
                            <label for="schoolAddress" class="block text-sm font-medium text-gray-700 mb-2">ที่อยู่โรงเรียน</label>
                            <textarea id="schoolAddress" rows="3" required 
                                      class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"></textarea>
                        </div>
                        
                        <div>
                            <label for="schoolPhone" class="block text-sm font-medium text-gray-700 mb-2">เบอร์โทรศัพท์</label>
                            <input type="tel" id="schoolPhone" required 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                        </div>
                        
                        <div>
                            <label for="schoolEmail" class="block text-sm font-medium text-gray-700 mb-2">อีเมลโรงเรียน</label>
                            <input type="email" id="schoolEmail" required 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                        </div>
                    </div>
                    
                    <!-- ข้อมูลผู้อำนวยการ -->
                    <div class="space-y-6">
                        <h2 class="text-xl font-semibold text-gray-800 border-b border-primary pb-2">
                            <i class="fas fa-user-tie text-primary mr-2"></i>ข้อมูลผู้อำนวยการ
                        </h2>
                        
                        <div>
                            <label for="directorFirstName" class="block text-sm font-medium text-gray-700 mb-2">ชื่อจริง</label>
                            <input type="text" id="directorFirstName" required 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                        </div>
                        
                        <div>
                            <label for="directorLastName" class="block text-sm font-medium text-gray-700 mb-2">นามสกุล</label>
                            <input type="text" id="directorLastName" required 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                        </div>
                        
                        <div>
                            <label for="directorUsername" class="block text-sm font-medium text-gray-700 mb-2">ชื่อผู้ใช้</label>
                            <input type="text" id="directorUsername" required 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                        </div>
                        
                        <div>
                            <label for="directorPhone" class="block text-sm font-medium text-gray-700 mb-2">เบอร์โทรศัพท์</label>
                            <input type="tel" id="directorPhone" required 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                        </div>
                        
                        <div>
                            <label for="directorPassword" class="block text-sm font-medium text-gray-700 mb-2">รหัสผ่าน</label>
                            <input type="password" id="directorPassword" required 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                        </div>
                        
                        <div>
                            <label for="confirmPassword" class="block text-sm font-medium text-gray-700 mb-2">ยืนยันรหัสผ่าน</label>
                            <input type="password" id="confirmPassword" required 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                        </div>
                    </div>
                    
                    <div class="md:col-span-2 flex justify-between pt-6">
                        <button type="button" onclick="showLoginPage()" 
                                class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition duration-200">
                            ย้อนกลับ
                        </button>
                        <button type="submit" 
                                class="px-8 py-3 bg-primary text-white rounded-lg font-medium hover:bg-opacity-90 transition duration-200">
                            บันทึกข้อมูลโรงเรียน
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Dashboard Layout -->
    <div id="dashboardLayout" class="hidden">
        <!-- Mobile Menu Button -->
        <button id="mobileMenuBtn" class="md:hidden fixed top-4 left-4 z-50 bg-primary text-white p-2 rounded-lg shadow-lg transition-all duration-300 hover:bg-opacity-90">
            <div class="hamburger-icon">
                <span class="hamburger-line"></span>
                <span class="hamburger-line"></span>
                <span class="hamburger-line"></span>
            </div>
        </button>

        <!-- Sidebar -->
        <div id="sidebar" class="sidebar fixed left-0 top-0 h-full w-64 bg-white shadow-lg z-40">
            <div class="p-4 border-b border-gray-200">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-primary rounded-full flex items-center justify-center flex-shrink-0">
                        <i class="fas fa-graduation-cap text-white"></i>
                    </div>
                    <div class="min-w-0 flex-1">
                        <h2 class="font-semibold text-gray-800 text-sm truncate" id="systemName">ระบบสื่อการสอน</h2>
                        <p class="text-xs text-gray-600 truncate" id="userRole">ผู้ดูแลระบบ</p>
                    </div>
                </div>
            </div>
            
            <nav class="p-4">
                <ul class="space-y-1" id="sidebarMenu">
                    <!-- Menu items will be populated by JavaScript -->
                </ul>
            </nav>
        </div>

        <!-- Main Content -->
        <div class="md:ml-64">
            <!-- Header -->
            <header class="bg-white shadow-sm border-b border-gray-200 p-4 md:pl-6">
                <div class="flex justify-between items-center">
                    <h1 class="text-xl md:text-2xl font-semibold text-gray-800 ml-12 md:ml-0" id="pageTitle">แดชบอร์ด</h1>
                    <div class="flex items-center space-x-4">
                        <div class="flex items-center space-x-2">
                            <span class="text-gray-700 text-sm md:text-base" id="currentUser">ผู้ใช้งาน</span>
                            <button onclick="logout()" class="text-danger hover:text-red-700 p-1">
                                <i class="fas fa-sign-out-alt"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Content Area -->
            <main class="p-6" id="mainContent">
                <!-- Content will be populated by JavaScript -->
            </main>
        </div>
    </div>

    <!-- Modals -->
    <!-- Add School Modal -->
    <div id="addSchoolModal" class="modal">
        <div class="bg-white rounded-lg p-6 w-full max-w-md mx-4">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold">เพิ่มโรงเรียน</h3>
                <button onclick="closeModal('addSchoolModal')" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="addSchoolForm" class="space-y-4">
                <div>
                    <label for="modalSchoolName" class="block text-sm font-medium text-gray-700 mb-2">ชื่อโรงเรียน</label>
                    <input type="text" id="modalSchoolName" required 
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                </div>
                <div>
                    <label for="modalSchoolCode" class="block text-sm font-medium text-gray-700 mb-2">รหัสโรงเรียน</label>
                    <input type="text" id="modalSchoolCode" required 
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                </div>
                <div class="flex justify-end space-x-3 pt-4">
                    <button type="button" onclick="closeModal('addSchoolModal')" 
                            class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50">
                        ยกเลิก
                    </button>
                    <button type="submit" 
                            class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-opacity-90">
                        บันทึก
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Subject Modal -->
    <div id="addSubjectModal" class="modal">
        <div class="bg-white rounded-lg p-6 w-full max-w-md mx-4">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold">เพิ่มรายวิชา</h3>
                <button onclick="closeModal('addSubjectModal')" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="addSubjectForm" class="space-y-4">
                <div>
                    <label for="subjectName" class="block text-sm font-medium text-gray-700 mb-2">ชื่อวิชา</label>
                    <input type="text" id="subjectName" required 
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                </div>
                <div>
                    <label for="subjectGrade" class="block text-sm font-medium text-gray-700 mb-2">ระดับชั้น</label>
                    <select id="subjectGrade" required 
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                        <option value="">เลือกระดับชั้น</option>
                        <option value="ม.1">ม.1</option>
                        <option value="ม.2">ม.2</option>
                        <option value="ม.3">ม.3</option>
                        <option value="ม.4">ม.4</option>
                        <option value="ม.5">ม.5</option>
                        <option value="ม.6">ม.6</option>
                    </select>
                </div>
                <div>
                    <label for="subjectYear" class="block text-sm font-medium text-gray-700 mb-2">ปีการศึกษา</label>
                    <input type="text" id="subjectYear" required placeholder="เช่น 2567" 
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                </div>
                <div>
                    <label for="subjectDescription" class="block text-sm font-medium text-gray-700 mb-2">คำอธิบายรายวิชา</label>
                    <textarea id="subjectDescription" rows="3" 
                              class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"></textarea>
                </div>
                <div class="flex justify-end space-x-3 pt-4">
                    <button type="button" onclick="closeModal('addSubjectModal')" 
                            class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50">
                        ยกเลิก
                    </button>
                    <button type="submit" 
                            class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-opacity-90">
                        บันทึก
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Material Modal -->
    <div id="addMaterialModal" class="modal">
        <div class="bg-white rounded-lg p-6 w-full max-w-lg mx-4">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold">เพิ่มสื่อการสอน</h3>
                <button onclick="closeModal('addMaterialModal')" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="addMaterialForm" class="space-y-4">
                <div>
                    <label for="materialTitle" class="block text-sm font-medium text-gray-700 mb-2">ชื่อสื่อการสอน</label>
                    <input type="text" id="materialTitle" required 
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                </div>
                <div>
                    <label for="materialSubject" class="block text-sm font-medium text-gray-700 mb-2">รายวิชา</label>
                    <select id="materialSubject" required 
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                        <option value="">เลือกรายวิชา</option>
                    </select>
                </div>
                <div>
                    <label for="materialType" class="block text-sm font-medium text-gray-700 mb-2">ประเภทสื่อ</label>
                    <select id="materialType" required 
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                        <option value="">เลือกประเภทสื่อ</option>
                        <option value="PDF">เอกสาร PDF</option>
                        <option value="Video">วิดีโอ</option>
                        <option value="PowerPoint">PowerPoint</option>
                        <option value="Image">รูปภาพ</option>
                        <option value="Audio">เสียง</option>
                        <option value="Link">ลิงก์เว็บไซต์</option>
                    </select>
                </div>
                <div>
                    <label for="materialDescription" class="block text-sm font-medium text-gray-700 mb-2">คำอธิบาย</label>
                    <textarea id="materialDescription" rows="3" 
                              class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"></textarea>
                </div>
                <div>
                    <label for="materialFile" class="block text-sm font-medium text-gray-700 mb-2">ไฟล์หรือลิงก์</label>
                    <div class="space-y-2">
                        <input type="file" id="materialFile" 
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"
                               accept=".pdf,.doc,.docx,.ppt,.pptx,.jpg,.jpeg,.png,.mp4,.mp3">
                        <p class="text-xs text-gray-500">หรือ</p>
                        <input type="url" id="materialUrl" placeholder="https://example.com/material" 
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                    </div>
                </div>
                <div class="flex justify-end space-x-3 pt-4">
                    <button type="button" onclick="closeModal('addMaterialModal')" 
                            class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50">
                        ยกเลิก
                    </button>
                    <button type="submit" 
                            class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-opacity-90">
                        บันทึก
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Evaluation Modal -->
    <div id="addEvaluationModal" class="modal">
        <div class="bg-white rounded-lg p-6 w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold">สร้างแบบประเมิน</h3>
                <button onclick="closeModal('addEvaluationModal')" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="addEvaluationForm" class="space-y-4">
                <div class="grid md:grid-cols-2 gap-4">
                    <div>
                        <label for="evaluationTitle" class="block text-sm font-medium text-gray-700 mb-2">ชื่อแบบประเมิน</label>
                        <input type="text" id="evaluationTitle" required 
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                    </div>
                    <div>
                        <label for="evaluationSubject" class="block text-sm font-medium text-gray-700 mb-2">รายวิชา</label>
                        <select id="evaluationSubject" required 
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                            <option value="">เลือกรายวิชา</option>
                        </select>
                    </div>
                </div>
                
                <div class="grid md:grid-cols-2 gap-4">
                    <div>
                        <label for="evaluationType" class="block text-sm font-medium text-gray-700 mb-2">ประเภทการประเมิน</label>
                        <select id="evaluationType" required 
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                            <option value="">เลือกประเภท</option>
                            <option value="quiz">แบบทดสอบ</option>
                            <option value="assignment">งานที่มอบหมาย</option>
                            <option value="project">โครงงาน</option>
                            <option value="presentation">การนำเสนอ</option>
                            <option value="participation">การมีส่วนร่วม</option>
                        </select>
                    </div>
                    <div>
                        <label for="evaluationScore" class="block text-sm font-medium text-gray-700 mb-2">คะแนนเต็ม</label>
                        <input type="number" id="evaluationScore" required min="1" max="100" value="100"
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                    </div>
                </div>
                
                <div>
                    <label for="evaluationDescription" class="block text-sm font-medium text-gray-700 mb-2">คำอธิบายแบบประเมิน</label>
                    <textarea id="evaluationDescription" rows="3" 
                              class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"></textarea>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">เกณฑ์การประเมิน</label>
                    <div id="criteriaContainer" class="space-y-3">
                        <div class="criteria-item flex items-center space-x-3 p-3 bg-gray-50 rounded-lg">
                            <input type="text" placeholder="หัวข้อการประเมิน" 
                                   class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent criteria-title">
                            <input type="number" placeholder="คะแนน" min="1" max="100" 
                                   class="w-20 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent criteria-score">
                            <button type="button" onclick="removeCriteria(this)" class="text-red-500 hover:text-red-700">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                    <button type="button" onclick="addCriteria()" 
                            class="mt-3 text-primary hover:text-primary-dark">
                        <i class="fas fa-plus mr-2"></i>เพิ่มเกณฑ์การประเมิน
                    </button>
                </div>
                
                <div class="grid md:grid-cols-2 gap-4">
                    <div>
                        <label for="evaluationDueDate" class="block text-sm font-medium text-gray-700 mb-2">วันที่ครบกำหนด</label>
                        <input type="datetime-local" id="evaluationDueDate" 
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                    </div>
                    <div>
                        <label for="evaluationWeight" class="block text-sm font-medium text-gray-700 mb-2">น้ำหนักคะแนน (%)</label>
                        <input type="number" id="evaluationWeight" min="1" max="100" value="10"
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                    </div>
                </div>
                
                <div class="flex justify-end space-x-3 pt-4">
                    <button type="button" onclick="closeModal('addEvaluationModal')" 
                            class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50">
                        ยกเลิก
                    </button>
                    <button type="submit" 
                            class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-opacity-90">
                        สร้างแบบประเมิน
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Grade Modal -->
    <div id="addGradeModal" class="modal">
        <div class="bg-white rounded-lg p-6 w-full max-w-lg mx-4">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold">เพิ่มผลการเรียน</h3>
                <button onclick="closeModal('addGradeModal')" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="addGradeForm" class="space-y-4">
                <div>
                    <label for="gradeStudentName" class="block text-sm font-medium text-gray-700 mb-2">ชื่อนักเรียน</label>
                    <input type="text" id="gradeStudentName" required 
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                </div>
                <div>
                    <label for="gradeStudentId" class="block text-sm font-medium text-gray-700 mb-2">รหัสนักเรียน</label>
                    <input type="text" id="gradeStudentId" required 
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                </div>
                <div>
                    <label for="gradeSubject" class="block text-sm font-medium text-gray-700 mb-2">รายวิชา</label>
                    <select id="gradeSubject" required 
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                        <option value="">เลือกรายวิชา</option>
                    </select>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label for="gradeMidterm" class="block text-sm font-medium text-gray-700 mb-2">คะแนนกลางภาค</label>
                        <input type="number" id="gradeMidterm" min="0" max="100" step="0.01"
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                    </div>
                    <div>
                        <label for="gradeFinal" class="block text-sm font-medium text-gray-700 mb-2">คะแนนปลายภาค</label>
                        <input type="number" id="gradeFinal" min="0" max="100" step="0.01"
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label for="gradeAssignment" class="block text-sm font-medium text-gray-700 mb-2">คะแนนงาน</label>
                        <input type="number" id="gradeAssignment" min="0" max="100" step="0.01"
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                    </div>
                    <div>
                        <label for="gradeParticipation" class="block text-sm font-medium text-gray-700 mb-2">คะแนนเข้าร่วม</label>
                        <input type="number" id="gradeParticipation" min="0" max="100" step="0.01"
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                    </div>
                </div>
                <div>
                    <label for="gradeNote" class="block text-sm font-medium text-gray-700 mb-2">หมายเหตุ</label>
                    <textarea id="gradeNote" rows="3" 
                              class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"></textarea>
                </div>
                <div class="flex justify-end space-x-3 pt-4">
                    <button type="button" onclick="closeModal('addGradeModal')" 
                            class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50">
                        ยกเลิก
                    </button>
                    <button type="submit" 
                            class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-opacity-90">
                        บันทึกผลการเรียน
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Grade Modal -->
    <div id="editGradeModal" class="modal">
        <div class="bg-white rounded-lg p-6 w-full max-w-lg mx-4">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold">แก้ไขผลการเรียน</h3>
                <button onclick="closeModal('editGradeModal')" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="editGradeForm" class="space-y-4">
                <input type="hidden" id="editGradeId">
                <div>
                    <label for="editGradeStudentName" class="block text-sm font-medium text-gray-700 mb-2">ชื่อนักเรียน</label>
                    <input type="text" id="editGradeStudentName" required 
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                </div>
                <div>
                    <label for="editGradeStudentId" class="block text-sm font-medium text-gray-700 mb-2">รหัสนักเรียน</label>
                    <input type="text" id="editGradeStudentId" required 
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                </div>
                <div>
                    <label for="editGradeSubject" class="block text-sm font-medium text-gray-700 mb-2">รายวิชา</label>
                    <select id="editGradeSubject" required 
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                        <option value="">เลือกรายวิชา</option>
                    </select>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label for="editGradeMidterm" class="block text-sm font-medium text-gray-700 mb-2">คะแนนกลางภาค</label>
                        <input type="number" id="editGradeMidterm" min="0" max="100" step="0.01"
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                    </div>
                    <div>
                        <label for="editGradeFinal" class="block text-sm font-medium text-gray-700 mb-2">คะแนนปลายภาค</label>
                        <input type="number" id="editGradeFinal" min="0" max="100" step="0.01"
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label for="editGradeAssignment" class="block text-sm font-medium text-gray-700 mb-2">คะแนนงาน</label>
                        <input type="number" id="editGradeAssignment" min="0" max="100" step="0.01"
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                    </div>
                    <div>
                        <label for="editGradeParticipation" class="block text-sm font-medium text-gray-700 mb-2">คะแนนเข้าร่วม</label>
                        <input type="number" id="editGradeParticipation" min="0" max="100" step="0.01"
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                    </div>
                </div>
                <div>
                    <label for="editGradeNote" class="block text-sm font-medium text-gray-700 mb-2">หมายเหตุ</label>
                    <textarea id="editGradeNote" rows="3" 
                              class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"></textarea>
                </div>
                <div class="flex justify-end space-x-3 pt-4">
                    <button type="button" onclick="closeModal('editGradeModal')" 
                            class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50">
                        ยกเลิก
                    </button>
                    <button type="submit" 
                            class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-opacity-90">
                        บันทึกการแก้ไข
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit School Modal -->
    <div id="editSchoolModal" class="modal">
        <div class="bg-white rounded-lg p-6 w-full max-w-lg mx-4">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold">แก้ไขข้อมูลโรงเรียน</h3>
                <button onclick="closeModal('editSchoolModal')" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="editSchoolForm" class="space-y-4">
                <input type="hidden" id="editSchoolId">
                <div>
                    <label for="editSchoolName" class="block text-sm font-medium text-gray-700 mb-2">ชื่อโรงเรียน</label>
                    <input type="text" id="editSchoolName" required 
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                </div>
                <div>
                    <label for="editSchoolCode" class="block text-sm font-medium text-gray-700 mb-2">รหัสโรงเรียน</label>
                    <input type="text" id="editSchoolCode" required 
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                </div>
                <div>
                    <label for="editSchoolEmail" class="block text-sm font-medium text-gray-700 mb-2">อีเมลโรงเรียน</label>
                    <input type="email" id="editSchoolEmail" 
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                </div>
                <div>
                    <label for="editSchoolPhone" class="block text-sm font-medium text-gray-700 mb-2">เบอร์โทรศัพท์</label>
                    <input type="tel" id="editSchoolPhone" 
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                </div>
                <div>
                    <label for="editSchoolAddress" class="block text-sm font-medium text-gray-700 mb-2">ที่อยู่</label>
                    <textarea id="editSchoolAddress" rows="3" 
                              class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"></textarea>
                </div>
                <div class="flex justify-end space-x-3 pt-4">
                    <button type="button" onclick="closeModal('editSchoolModal')" 
                            class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50">
                        ยกเลิก
                    </button>
                    <button type="submit" 
                            class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-opacity-90">
                        บันทึกการแก้ไข
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Teacher Modal -->
    <div id="addTeacherModal" class="modal">
        <div class="bg-white rounded-lg p-6 w-full max-w-lg mx-4">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold">เพิ่มครู</h3>
                <button onclick="closeModal('addTeacherModal')" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="addTeacherForm" class="space-y-4">
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label for="teacherFirstName" class="block text-sm font-medium text-gray-700 mb-2">ชื่อจริง</label>
                        <input type="text" id="teacherFirstName" required 
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                    </div>
                    <div>
                        <label for="teacherLastName" class="block text-sm font-medium text-gray-700 mb-2">นามสกุล</label>
                        <input type="text" id="teacherLastName" required 
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                    </div>
                </div>
                <div>
                    <label for="teacherUsername" class="block text-sm font-medium text-gray-700 mb-2">ชื่อผู้ใช้</label>
                    <input type="text" id="teacherUsername" required 
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                </div>
                <div>
                    <label for="teacherEmail" class="block text-sm font-medium text-gray-700 mb-2">อีเมล</label>
                    <input type="email" id="teacherEmail" required 
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                </div>
                <div>
                    <label for="teacherPhone" class="block text-sm font-medium text-gray-700 mb-2">เบอร์โทรศัพท์</label>
                    <input type="tel" id="teacherPhone" 
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                </div>
                <div>
                    <label for="teacherPassword" class="block text-sm font-medium text-gray-700 mb-2">รหัสผ่าน</label>
                    <input type="password" id="teacherPassword" required 
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                </div>
                <div>
                    <label for="teacherConfirmPassword" class="block text-sm font-medium text-gray-700 mb-2">ยืนยันรหัสผ่าน</label>
                    <input type="password" id="teacherConfirmPassword" required 
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                </div>
                <div class="flex justify-end space-x-3 pt-4">
                    <button type="button" onclick="closeModal('addTeacherModal')" 
                            class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50">
                        ยกเลิก
                    </button>
                    <button type="submit" 
                            class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-opacity-90">
                        เพิ่มครู
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Teacher Modal -->
    <div id="editTeacherModal" class="modal">
        <div class="bg-white rounded-lg p-6 w-full max-w-lg mx-4">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold">แก้ไขข้อมูลครู</h3>
                <button onclick="closeModal('editTeacherModal')" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="editTeacherForm" class="space-y-4">
                <input type="hidden" id="editTeacherId">
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label for="editTeacherFirstName" class="block text-sm font-medium text-gray-700 mb-2">ชื่อจริง</label>
                        <input type="text" id="editTeacherFirstName" required 
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                    </div>
                    <div>
                        <label for="editTeacherLastName" class="block text-sm font-medium text-gray-700 mb-2">นามสกุล</label>
                        <input type="text" id="editTeacherLastName" required 
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                    </div>
                </div>
                <div>
                    <label for="editTeacherUsername" class="block text-sm font-medium text-gray-700 mb-2">ชื่อผู้ใช้</label>
                    <input type="text" id="editTeacherUsername" required 
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                </div>
                <div>
                    <label for="editTeacherEmail" class="block text-sm font-medium text-gray-700 mb-2">อีเมล</label>
                    <input type="email" id="editTeacherEmail" required 
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                </div>
                <div>
                    <label for="editTeacherPhone" class="block text-sm font-medium text-gray-700 mb-2">เบอร์โทรศัพท์</label>
                    <input type="tel" id="editTeacherPhone" 
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                </div>
                <div class="flex justify-end space-x-3 pt-4">
                    <button type="button" onclick="closeModal('editTeacherModal')" 
                            class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50">
                        ยกเลิก
                    </button>
                    <button type="submit" 
                            class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-opacity-90">
                        บันทึกการแก้ไข
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Academic Year Modal -->
    <div id="addAcademicYearModal" class="modal">
        <div class="bg-white rounded-lg p-6 w-full max-w-md mx-4">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold">เพิ่มปีการศึกษา</h3>
                <button onclick="closeModal('addAcademicYearModal')" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="addAcademicYearForm" class="space-y-4">
                <div>
                    <label for="academicYear" class="block text-sm font-medium text-gray-700 mb-2">ปีการศึกษา</label>
                    <input type="text" id="academicYear" required placeholder="เช่น 2568"
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                </div>
                <div>
                    <label for="academicStartDate" class="block text-sm font-medium text-gray-700 mb-2">วันที่เริ่มต้น</label>
                    <input type="date" id="academicStartDate" required 
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                </div>
                <div>
                    <label for="academicEndDate" class="block text-sm font-medium text-gray-700 mb-2">วันที่สิ้นสุด</label>
                    <input type="date" id="academicEndDate" required 
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                </div>
                <div>
                    <label for="academicDescription" class="block text-sm font-medium text-gray-700 mb-2">คำอธิบาย</label>
                    <textarea id="academicDescription" rows="3" 
                              class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"></textarea>
                </div>
                <div class="flex justify-end space-x-3 pt-4">
                    <button type="button" onclick="closeModal('addAcademicYearModal')" 
                            class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50">
                        ยกเลิก
                    </button>
                    <button type="submit" 
                            class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-opacity-90">
                        บันทึก
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Academic Year Modal -->
    <div id="editAcademicYearModal" class="modal">
        <div class="bg-white rounded-lg p-6 w-full max-w-md mx-4">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold">แก้ไขปีการศึกษา</h3>
                <button onclick="closeModal('editAcademicYearModal')" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="editAcademicYearForm" class="space-y-4">
                <input type="hidden" id="editAcademicYearId">
                <div>
                    <label for="editAcademicYear" class="block text-sm font-medium text-gray-700 mb-2">ปีการศึกษา</label>
                    <input type="text" id="editAcademicYear" required 
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                </div>
                <div>
                    <label for="editAcademicStartDate" class="block text-sm font-medium text-gray-700 mb-2">วันที่เริ่มต้น</label>
                    <input type="date" id="editAcademicStartDate" required 
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                </div>
                <div>
                    <label for="editAcademicEndDate" class="block text-sm font-medium text-gray-700 mb-2">วันที่สิ้นสุด</label>
                    <input type="date" id="editAcademicEndDate" required 
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                </div>
                <div>
                    <label for="editAcademicStatus" class="block text-sm font-medium text-gray-700 mb-2">สถานะ</label>
                    <select id="editAcademicStatus" required 
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                        <option value="active">ใช้งาน</option>
                        <option value="completed">สิ้นสุดแล้ว</option>
                        <option value="upcoming">กำลังจะมาถึง</option>
                    </select>
                </div>
                <div>
                    <label for="editAcademicDescription" class="block text-sm font-medium text-gray-700 mb-2">คำอธิบาย</label>
                    <textarea id="editAcademicDescription" rows="3" 
                              class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"></textarea>
                </div>
                <div class="flex justify-end space-x-3 pt-4">
                    <button type="button" onclick="closeModal('editAcademicYearModal')" 
                            class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50">
                        ยกเลิก
                    </button>
                    <button type="submit" 
                            class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-opacity-90">
                        บันทึกการแก้ไข
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Announcement Modal -->
    <div id="addAnnouncementModal" class="modal">
        <div class="bg-white rounded-lg p-6 w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold">สร้างประกาศแจ้งเตือน</h3>
                <button onclick="closeModal('addAnnouncementModal')" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="addAnnouncementForm" class="space-y-4">
                <div>
                    <label for="announcementTitle" class="block text-sm font-medium text-gray-700 mb-2">หัวข้อประกาศ</label>
                    <input type="text" id="announcementTitle" required 
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                </div>
                
                <div>
                    <label for="announcementContent" class="block text-sm font-medium text-gray-700 mb-2">เนื้อหาประกาศ</label>
                    <textarea id="announcementContent" rows="5" required 
                              class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"></textarea>
                </div>
                
                <div class="grid md:grid-cols-2 gap-4">
                    <div>
                        <label for="announcementType" class="block text-sm font-medium text-gray-700 mb-2">ประเภทประกาศ</label>
                        <select id="announcementType" required 
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                            <option value="">เลือกประเภท</option>
                            <option value="general">ทั่วไป</option>
                            <option value="urgent">ด่วน</option>
                            <option value="training">การอบรม</option>
                            <option value="maintenance">การบำรุงรักษา</option>
                            <option value="policy">นโยบาย</option>
                        </select>
                    </div>
                    <div>
                        <label for="announcementPriority" class="block text-sm font-medium text-gray-700 mb-2">ระดับความสำคัญ</label>
                        <select id="announcementPriority" required 
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                            <option value="">เลือกระดับ</option>
                            <option value="low">ต่ำ</option>
                            <option value="medium">ปานกลาง</option>
                            <option value="high">สูง</option>
                        </select>
                    </div>
                </div>
                
                <div>
                    <label for="announcementAudience" class="block text-sm font-medium text-gray-700 mb-2">กลุ่มเป้าหมาย</label>
                    <select id="announcementAudience" required onchange="toggleSchoolSelection()"
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                        <option value="">เลือกกลุ่มเป้าหมาย</option>
                        <option value="all">ทุกคน</option>
                        <option value="teachers">ครูทั้งหมด</option>
                        <option value="directors">ผู้อำนวยการทั้งหมด</option>
                        <option value="specific_schools">โรงเรียนเฉพาะ</option>
                    </select>
                </div>
                
                <div id="schoolSelectionDiv" class="hidden">
                    <label class="block text-sm font-medium text-gray-700 mb-2">เลือกโรงเรียน</label>
                    <div id="schoolCheckboxes" class="space-y-2 max-h-40 overflow-y-auto border border-gray-300 rounded-lg p-3">
                        <!-- School checkboxes will be populated here -->
                    </div>
                </div>
                
                <div class="flex justify-end space-x-3 pt-4">
                    <button type="button" onclick="closeModal('addAnnouncementModal')" 
                            class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50">
                        ยกเลิก
                    </button>
                    <button type="submit" 
                            class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-opacity-90">
                        สร้างประกาศ
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Announcement Modal -->
    <div id="editAnnouncementModal" class="modal">
        <div class="bg-white rounded-lg p-6 w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold">แก้ไขประกาศแจ้งเตือน</h3>
                <button onclick="closeModal('editAnnouncementModal')" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="editAnnouncementForm" class="space-y-4">
                <input type="hidden" id="editAnnouncementId">
                <div>
                    <label for="editAnnouncementTitle" class="block text-sm font-medium text-gray-700 mb-2">หัวข้อประกาศ</label>
                    <input type="text" id="editAnnouncementTitle" required 
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                </div>
                
                <div>
                    <label for="editAnnouncementContent" class="block text-sm font-medium text-gray-700 mb-2">เนื้อหาประกาศ</label>
                    <textarea id="editAnnouncementContent" rows="5" required 
                              class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"></textarea>
                </div>
                
                <div class="grid md:grid-cols-2 gap-4">
                    <div>
                        <label for="editAnnouncementType" class="block text-sm font-medium text-gray-700 mb-2">ประเภทประกาศ</label>
                        <select id="editAnnouncementType" required 
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                            <option value="general">ทั่วไป</option>
                            <option value="urgent">ด่วน</option>
                            <option value="training">การอบรม</option>
                            <option value="maintenance">การบำรุงรักษา</option>
                            <option value="policy">นโยบาย</option>
                        </select>
                    </div>
                    <div>
                        <label for="editAnnouncementPriority" class="block text-sm font-medium text-gray-700 mb-2">ระดับความสำคัญ</label>
                        <select id="editAnnouncementPriority" required 
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                            <option value="low">ต่ำ</option>
                            <option value="medium">ปานกลาง</option>
                            <option value="high">สูง</option>
                        </select>
                    </div>
                </div>
                
                <div>
                    <label for="editAnnouncementStatus" class="block text-sm font-medium text-gray-700 mb-2">สถานะ</label>
                    <select id="editAnnouncementStatus" required 
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                        <option value="true">เปิดใช้งาน</option>
                        <option value="false">ปิดใช้งาน</option>
                    </select>
                </div>
                
                <div class="flex justify-end space-x-3 pt-4">
                    <button type="button" onclick="closeModal('editAnnouncementModal')" 
                            class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50">
                        ยกเลิก
                    </button>
                    <button type="submit" 
                            class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-opacity-90">
                        บันทึกการแก้ไข
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Global variables
        let currentUser = null;
        let currentRole = null;
        let schools = JSON.parse(localStorage.getItem('schools') || '[]');
        let users = JSON.parse(localStorage.getItem('users') || '[]');
        let notifications = JSON.parse(localStorage.getItem('notifications') || '[]');
        let systemSettings = JSON.parse(localStorage.getItem('systemSettings') || '{}');

        // Initialize system settings
        if (Object.keys(systemSettings).length === 0) {
            systemSettings = {
                systemName: 'ระบบสื่อการสอนและผลการเรียน'
            };
            localStorage.setItem('systemSettings', JSON.stringify(systemSettings));
        }

        // Initialize default users and data
        if (users.length === 0) {
            users = [
                {
                    id: 1,
                    username: 'admin',
                    password: 'admin123',
                    role: 'admin',
                    firstName: 'ผู้ดูแล',
                    lastName: 'ระบบ',
                    email: 'admin@system.com'
                },
                {
                    id: 2,
                    username: 'teacher1',
                    password: 'teacher123',
                    role: 'teacher',
                    firstName: 'สมชาย',
                    lastName: 'ใจดี',
                    email: 'teacher1@school.com',
                    schoolId: 1
                },
                {
                    id: 3,
                    username: 'director1',
                    password: 'director123',
                    role: 'director',
                    firstName: 'สมหญิง',
                    lastName: 'ผู้อำนวย',
                    email: 'director1@school.com',
                    schoolId: 1
                }
            ];
            localStorage.setItem('users', JSON.stringify(users));
        }

        // Initialize sample data
        let subjects = JSON.parse(localStorage.getItem('subjects') || '[]');
        let materials = JSON.parse(localStorage.getItem('materials') || '[]');
        let grades = JSON.parse(localStorage.getItem('grades') || '[]');
        let evaluations = JSON.parse(localStorage.getItem('evaluations') || '[]');
        let academicYears = JSON.parse(localStorage.getItem('academicYears') || '[]');
        let announcements = JSON.parse(localStorage.getItem('announcements') || '[]');

        if (subjects.length === 0) {
            subjects = [
                {
                    id: 1,
                    name: 'คณิตศาสตร์',
                    grade: 'ม.1',
                    year: '2567',
                    description: 'คณิตศาสตร์พื้นฐาน',
                    teacherId: 2,
                    schoolId: 1
                },
                {
                    id: 2,
                    name: 'ภาษาไทย',
                    grade: 'ม.2',
                    year: '2567',
                    description: 'ภาษาไทยเพื่อการสื่อสาร',
                    teacherId: 2,
                    schoolId: 1
                }
            ];
            localStorage.setItem('subjects', JSON.stringify(subjects));
        }

        if (materials.length === 0) {
            materials = [
                {
                    id: 1,
                    name: 'เอกสารคณิตศาสตร์ บทที่ 1',
                    type: 'PDF',
                    subjectId: 1,
                    teacherId: 2,
                    description: 'เอกสารประกอบการเรียนคณิตศาสตร์',
                    url: '#',
                    uploadDate: '2024-01-15'
                }
            ];
            localStorage.setItem('materials', JSON.stringify(materials));
        }

        if (evaluations.length === 0) {
            evaluations = [
                {
                    id: 1,
                    title: 'แบบทดสอบคณิตศาสตร์ บทที่ 1',
                    type: 'quiz',
                    subjectId: 1,
                    teacherId: 2,
                    description: 'แบบทดสอบเรื่องจำนวนจริง',
                    maxScore: 100,
                    weight: 20,
                    dueDate: '2024-02-15T23:59',
                    criteria: [
                        { title: 'ความถูกต้อง', score: 60 },
                        { title: 'ความเข้าใจ', score: 40 }
                    ]
                }
            ];
            localStorage.setItem('evaluations', JSON.stringify(evaluations));
        }

        if (grades.length === 0) {
            grades = [
                {
                    id: 1,
                    studentName: 'สมชาย ใจดี',
                    studentId: '65001',
                    subjectId: 1,
                    teacherId: 2,
                    midtermScore: 85,
                    finalScore: 90,
                    assignmentScore: 88,
                    participationScore: 92,
                    totalScore: 88.75,
                    grade: 'A',
                    status: 'pending',
                    note: 'นักเรียนมีความตั้งใจในการเรียน'
                },
                {
                    id: 2,
                    studentName: 'สมหญิง รักเรียน',
                    studentId: '65002',
                    subjectId: 1,
                    teacherId: 2,
                    midtermScore: 78,
                    finalScore: 82,
                    assignmentScore: 85,
                    participationScore: 88,
                    totalScore: 83.25,
                    grade: 'B+',
                    status: 'approved',
                    note: ''
                }
            ];
            localStorage.setItem('grades', JSON.stringify(grades));
        }

        // Initialize academic years
        if (academicYears.length === 0) {
            academicYears = [
                {
                    id: 1,
                    year: '2567',
                    startDate: '2024-05-16',
                    endDate: '2025-03-31',
                    status: 'active',
                    description: 'ปีการศึกษา 2567',
                    createdBy: 3, // director1
                    createdAt: '2024-01-15T10:30:00',
                    lastEditedBy: 3,
                    lastEditedAt: '2024-01-15T10:30:00'
                },
                {
                    id: 2,
                    year: '2566',
                    startDate: '2023-05-16',
                    endDate: '2024-03-31',
                    status: 'completed',
                    description: 'ปีการศึกษา 2566',
                    createdBy: 2, // teacher1
                    createdAt: '2023-01-10T09:15:00',
                    lastEditedBy: 3,
                    lastEditedAt: '2024-03-31T16:45:00'
                }
            ];
            localStorage.setItem('academicYears', JSON.stringify(academicYears));
        }

        // Initialize sample school
        if (schools.length === 0) {
            schools = [
                {
                    id: 1,
                    name: 'โรงเรียนตัวอย่าง',
                    code: 'SCH001',
                    address: '123 ถนนตัวอย่าง เขตตัวอย่าง กรุงเทพฯ 10100',
                    phone: '02-123-4567',
                    email: 'info@school.com',
                    status: 'approved'
                }
            ];
            localStorage.setItem('schools', JSON.stringify(schools));
        }

        // Initialize sample announcements
        if (announcements.length === 0) {
            announcements = [
                {
                    id: 1,
                    title: 'ประกาศเปิดภาคเรียนใหม่',
                    content: 'แจ้งให้ทราบว่าภาคเรียนที่ 1 ปีการศึกษา 2568 จะเริ่มต้นในวันที่ 16 พฤษภาคม 2567 กรุณาเตรียมความพร้อมและจัดทำแผนการสอนให้เรียบร้อย',
                    type: 'general',
                    priority: 'high',
                    targetAudience: 'all',
                    targetSchools: [],
                    createdBy: 1,
                    createdAt: '2024-01-15T10:00:00',
                    isActive: true,
                    readBy: []
                },
                {
                    id: 2,
                    title: 'การอบรมระบบใหม่',
                    content: 'จะมีการอบรมการใช้งานระบบสื่อการสอนและผลการเรียนใหม่ในวันที่ 20 มกราคม 2567 เวลา 09:00-16:00 น. ณ ห้องประชุมใหญ่',
                    type: 'training',
                    priority: 'medium',
                    targetAudience: 'teachers',
                    targetSchools: [1],
                    createdBy: 1,
                    createdAt: '2024-01-10T14:30:00',
                    isActive: true,
                    readBy: []
                },
                {
                    id: 3,
                    title: 'ปรับปรุงระบบชั่วคราว',
                    content: 'ระบบจะมีการปรับปรุงในวันที่ 25 มกราคม 2567 เวลา 22:00-02:00 น. อาจมีการหยุดให้บริการชั่วคราว ขออภัยในความไม่สะดวก',
                    type: 'maintenance',
                    priority: 'low',
                    targetAudience: 'all',
                    targetSchools: [],
                    createdBy: 1,
                    createdAt: '2024-01-08T16:45:00',
                    isActive: true,
                    readBy: [2, 3]
                }
            ];
            localStorage.setItem('announcements', JSON.stringify(announcements));
        }

        // Show loading
        function showLoading() {
            document.getElementById('loadingOverlay').classList.remove('hidden');
        }

        // Hide loading
        function hideLoading() {
            document.getElementById('loadingOverlay').classList.add('hidden');
        }

        // Show toast notification
        function showToast(title, message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastTitle = document.getElementById('toastTitle');
            const toastMessage = document.getElementById('toastMessage');
            
            toastTitle.textContent = title;
            toastMessage.textContent = message;
            
            // Update toast style based on type
            toast.className = 'toast bg-white border-l-4 p-4 rounded-lg shadow-lg max-w-sm';
            if (type === 'success') {
                toast.classList.add('border-primary');
            } else if (type === 'error') {
                toast.classList.add('border-danger');
            } else if (type === 'warning') {
                toast.classList.add('border-warning');
            }
            
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Show modal
        function showModal(modalId) {
            document.getElementById(modalId).classList.add('show');
        }

        // Close modal
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('show');
        }



        // Select user type function
        function selectUserType(type) {
            // Remove active class from all buttons
            document.querySelectorAll('.user-type-btn').forEach(btn => {
                btn.classList.remove('border-primary', 'bg-primary', 'bg-opacity-10');
                btn.classList.add('border-gray-200');
                const icon = btn.querySelector('i');
                const text = btn.querySelector('span');
                icon.classList.remove('text-primary');
                icon.classList.add('text-gray-400');
                text.classList.remove('text-primary');
                text.classList.add('text-gray-700');
            });
            
            // Add active class to selected button
            const selectedBtn = document.querySelector(`[data-type="${type}"]`);
            selectedBtn.classList.remove('border-gray-200');
            selectedBtn.classList.add('border-primary', 'bg-primary', 'bg-opacity-10');
            const icon = selectedBtn.querySelector('i');
            const text = selectedBtn.querySelector('span');
            icon.classList.remove('text-gray-400');
            icon.classList.add('text-primary');
            text.classList.remove('text-gray-700');
            text.classList.add('text-primary');
            
            // Set selected user type
            document.getElementById('selectedUserType').value = type;
            
            // Auto-fill demo credentials
            const demoCredentials = {
                'admin': { username: 'admin', password: 'admin123' },
                'teacher': { username: 'teacher1', password: 'teacher123' },
                'director': { username: 'director1', password: 'director123' }
            };
            
            if (demoCredentials[type]) {
                document.getElementById('username').value = demoCredentials[type].username;
                document.getElementById('password').value = demoCredentials[type].password;
            }
        }

        // Login form handler
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const selectedType = document.getElementById('selectedUserType').value;
            
            if (!username || !password) {
                showToast('ข้อผิดพลาด', 'กรุณากรอกชื่อผู้ใช้และรหัสผ่าน', 'error');
                return;
            }
            
            if (!selectedType) {
                showToast('ข้อผิดพลาด', 'กรุณาเลือกประเภทผู้ใช้', 'error');
                return;
            }
            
            showLoading();
            
            // ลดเวลา loading และแก้ไขการค้าง
            setTimeout(() => {
                try {
                    const user = users.find(u => u.username === username && u.password === password && u.role === selectedType);
                    
                    if (user) {
                        currentUser = user;
                        currentRole = user.role;
                        
                        // ซ่อน loading ก่อนเปลี่ยนหน้า
                        hideLoading();
                        
                        document.getElementById('loginPage').classList.add('hidden');
                        document.getElementById('dashboardLayout').classList.remove('hidden');
                        
                        initializeDashboard();
                        showToast('เข้าสู่ระบบสำเร็จ', `ยินดีต้อนรับ ${user.firstName} ${user.lastName}`);
                    } else {
                        hideLoading();
                        showToast('เข้าสู่ระบบไม่สำเร็จ', 'ชื่อผู้ใช้ รหัสผ่าน หรือประเภทผู้ใช้ไม่ถูกต้อง', 'error');
                    }
                } catch (error) {
                    hideLoading();
                    showToast('ข้อผิดพลาด', 'เกิดข้อผิดพลาดในระบบ', 'error');
                }
            }, 500);
        });

        // Register form handler
        document.getElementById('registerForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const password = document.getElementById('directorPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (password !== confirmPassword) {
                showToast('ข้อผิดพลาด', 'รหัสผ่านไม่ตรงกัน', 'error');
                return;
            }
            
            if (password.length < 6) {
                showToast('ข้อผิดพลาด', 'รหัสผ่านต้องมีอย่างน้อย 6 ตัวอักษร', 'error');
                return;
            }
            
            showLoading();
            
            setTimeout(() => {
                try {
                    const schoolData = {
                        id: Date.now(),
                        name: document.getElementById('schoolName').value,
                        code: document.getElementById('schoolCode').value,
                        address: document.getElementById('schoolAddress').value,
                        phone: document.getElementById('schoolPhone').value,
                        email: document.getElementById('schoolEmail').value,
                        status: 'pending'
                    };
                    
                    const directorData = {
                        id: Date.now() + 1,
                        username: document.getElementById('directorUsername').value,
                        password: password,
                        role: 'director',
                        firstName: document.getElementById('directorFirstName').value,
                        lastName: document.getElementById('directorLastName').value,
                        phone: document.getElementById('directorPhone').value,
                        schoolId: schoolData.id
                    };
                    
                    schools.push(schoolData);
                    users.push(directorData);
                    
                    localStorage.setItem('schools', JSON.stringify(schools));
                    localStorage.setItem('users', JSON.stringify(users));
                    
                    hideLoading();
                    showToast('ลงทะเบียนสำเร็จ', 'รอการอนุมัติจากผู้ดูแลระบบ');
                    
                    // รีเซ็ตฟอร์มและกลับไปหน้า login
                    document.getElementById('registerForm').reset();
                    showLoginPage();
                    
                } catch (error) {
                    hideLoading();
                    showToast('ข้อผิดพลาด', 'เกิดข้อผิดพลาดในการลงทะเบียน', 'error');
                }
            }, 800);
        });

        // Initialize dashboard based on role
        function initializeDashboard() {
            document.getElementById('currentUser').textContent = `${currentUser.firstName} ${currentUser.lastName}`;
            document.getElementById('userRole').textContent = getRoleText(currentUser.role);
            document.getElementById('systemName').textContent = systemSettings.systemName || 'ระบบสื่อการสอน';
            
            setupSidebar();
            loadDashboardContent();
        }

        // Get role text in Thai
        function getRoleText(role) {
            const roleMap = {
                'admin': 'ผู้ดูแลระบบ',
                'teacher': 'ครู',
                'director': 'ผู้อำนวยการ'
            };
            return roleMap[role] || role;
        }

        // Setup sidebar based on role
        function setupSidebar() {
            const sidebarMenu = document.getElementById('sidebarMenu');
            let menuItems = [];
            
            if (currentRole === 'admin') {
                menuItems = [
                    { icon: 'fas fa-tachometer-alt', text: 'แดชบอร์ด', page: 'dashboard' },
                    { icon: 'fas fa-school', text: 'จัดการโรงเรียน', page: 'schools' },
                    { icon: 'fas fa-users', text: 'จัดการผู้ใช้', page: 'users' },
                    { icon: 'fas fa-bullhorn', text: 'ประกาศแจ้งเตือน', page: 'announcements' },
                    { icon: 'fas fa-calendar-alt', text: 'จัดการปีการศึกษา', page: 'academic-years' },
                    { icon: 'fas fa-cog', text: 'ตั้งค่าระบบ', page: 'settings' },
                    { icon: 'fas fa-chart-bar', text: 'รายงานภาพรวม', page: 'reports' }
                ];
            } else if (currentRole === 'teacher') {
                menuItems = [
                    { icon: 'fas fa-tachometer-alt', text: 'แดชบอร์ด', page: 'dashboard' },
                    { icon: 'fas fa-bell', text: 'ประกาศแจ้งเตือน', page: 'view-announcements' },
                    { icon: 'fas fa-book', text: 'จัดการรายวิชา', page: 'subjects' },
                    { icon: 'fas fa-file-upload', text: 'สื่อการสอน', page: 'materials' },
                    { icon: 'fas fa-clipboard-list', text: 'ผลการเรียน', page: 'grades' },
                    { icon: 'fas fa-paper-plane', text: 'ส่งแบบประเมิน', page: 'evaluations' }
                ];
            } else if (currentRole === 'director') {
                menuItems = [
                    { icon: 'fas fa-tachometer-alt', text: 'แดชบอร์ด', page: 'dashboard' },
                    { icon: 'fas fa-bell', text: 'ประกาศแจ้งเตือน', page: 'view-announcements' },
                    { icon: 'fas fa-clipboard-check', text: 'ตรวจสอบผลการเรียน', page: 'approve-grades' },
                    { icon: 'fas fa-check-circle', text: 'อนุมัติรายงานผล', page: 'approve-reports' },
                    { icon: 'fas fa-school', text: 'ข้อมูลโรงเรียน', page: 'school-info' },
                    { icon: 'fas fa-calendar-alt', text: 'ปีการศึกษา', page: 'academic-years' },
                    { icon: 'fas fa-chart-line', text: 'รายงานรวมครู', page: 'teacher-summary' }
                ];
            }
            
            sidebarMenu.innerHTML = menuItems.map(item => `
                <li>
                    <a href="#" onclick="loadPage('${item.page}')" 
                       class="flex items-center space-x-3 p-2 rounded-lg text-gray-700 hover:bg-primary hover:text-white transition duration-200 text-sm">
                        <i class="${item.icon} w-4"></i>
                        <span class="truncate">${item.text}</span>
                    </a>
                </li>
            `).join('');
        }

        // Load dashboard content
        function loadDashboardContent() {
            loadPage('dashboard');
        }

        // Load page content
        function loadPage(page) {
            const mainContent = document.getElementById('mainContent');
            const pageTitle = document.getElementById('pageTitle');
            
            // แสดง loading ระหว่างเปลี่ยนหน้า
            mainContent.innerHTML = '<div class="flex justify-center items-center py-12"><div class="loading-spinner"></div><span class="ml-3 text-gray-600">กำลังโหลด...</span></div>';
            
            // ใช้ setTimeout เพื่อให้ UI อัพเดท
            setTimeout(() => {
                try {
                    switch(page) {
                        case 'dashboard':
                            pageTitle.textContent = 'แดชบอร์ด';
                            mainContent.innerHTML = getDashboardContent();
                            break;
                case 'schools':
                    pageTitle.textContent = 'จัดการโรงเรียน';
                    mainContent.innerHTML = getSchoolsContent();
                    break;
                case 'users':
                    pageTitle.textContent = 'จัดการผู้ใช้';
                    mainContent.innerHTML = getUsersContent();
                    break;
                case 'subjects':
                    pageTitle.textContent = 'จัดการรายวิชา';
                    mainContent.innerHTML = getSubjectsContent();
                    break;
                case 'materials':
                    pageTitle.textContent = 'สื่อการสอน';
                    mainContent.innerHTML = getMaterialsContent();
                    break;
                case 'grades':
                    pageTitle.textContent = 'ผลการเรียน';
                    mainContent.innerHTML = getGradesContent();
                    break;
                case 'evaluations':
                    pageTitle.textContent = 'ส่งแบบประเมิน';
                    mainContent.innerHTML = getEvaluationsContent();
                    break;
                case 'approve-grades':
                    pageTitle.textContent = 'ตรวจสอบผลการเรียน';
                    mainContent.innerHTML = getApproveGradesContent();
                    break;
                case 'approve-reports':
                    pageTitle.textContent = 'อนุมัติรายงานผล';
                    mainContent.innerHTML = getApproveReportsContent();
                    break;
                case 'school-info':
                    pageTitle.textContent = 'ข้อมูลโรงเรียน';
                    mainContent.innerHTML = getSchoolInfoContent();
                    break;
                case 'teacher-summary':
                    pageTitle.textContent = 'รายงานรวมครู';
                    mainContent.innerHTML = getTeacherSummaryContent();
                    break;
                case 'settings':
                    pageTitle.textContent = 'ตั้งค่าระบบ';
                    mainContent.innerHTML = getSettingsContent();
                    break;
                case 'reports':
                    pageTitle.textContent = 'รายงานภาพรวม';
                    mainContent.innerHTML = getReportsContent();
                    break;
                case 'academic-years':
                    pageTitle.textContent = 'จัดการปีการศึกษา';
                    mainContent.innerHTML = getAcademicYearsContent();
                    break;
                case 'announcements':
                    pageTitle.textContent = 'ประกาศแจ้งเตือน';
                    mainContent.innerHTML = getAnnouncementsContent();
                    break;
                case 'view-announcements':
                    pageTitle.textContent = 'ประกาศแจ้งเตือน';
                    mainContent.innerHTML = getViewAnnouncementsContent();
                    break;
                        default:
                            pageTitle.textContent = 'หน้าที่ไม่พบ';
                            mainContent.innerHTML = '<div class="text-center py-12"><p class="text-gray-500">หน้าที่คุณต้องการยังไม่พร้อมใช้งาน</p></div>';
                    }
                } catch (error) {
                    console.error('Error loading page:', error);
                    pageTitle.textContent = 'เกิดข้อผิดพลาด';
                    mainContent.innerHTML = '<div class="text-center py-12"><p class="text-red-500">เกิดข้อผิดพลาดในการโหลดหน้า</p><button onclick="location.reload()" class="mt-4 bg-primary text-white px-4 py-2 rounded-lg">รีเฟรชหน้า</button></div>';
                }
                
                // Close mobile menu
                const sidebar = document.getElementById('sidebar');
                const hamburgerIcon = document.getElementById('mobileMenuBtn').querySelector('.hamburger-icon');
                sidebar.classList.remove('open');
                hamburgerIcon.classList.remove('active');
            }, 100);
        }

        // Get dashboard content based on role
        function getDashboardContent() {
            if (currentRole === 'admin') {
                return `
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                        <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-600">โรงเรียนทั้งหมด</p>
                                    <p class="text-2xl font-bold text-primary">${schools.length}</p>
                                </div>
                                <i class="fas fa-school text-3xl text-primary opacity-20"></i>
                            </div>
                        </div>
                        <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-600">ผู้ใช้ทั้งหมด</p>
                                    <p class="text-2xl font-bold text-secondary">${users.length}</p>
                                </div>
                                <i class="fas fa-users text-3xl text-secondary opacity-20"></i>
                            </div>
                        </div>
                        <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-600">รออนุมัติ</p>
                                    <p class="text-2xl font-bold text-warning">${schools.filter(s => s.status === 'pending').length}</p>
                                </div>
                                <i class="fas fa-clock text-3xl text-warning opacity-20"></i>
                            </div>
                        </div>
                        <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-600">การแจ้งเตือน</p>
                                    <p class="text-2xl font-bold text-danger">${notifications.length}</p>
                                </div>
                                <i class="fas fa-bell text-3xl text-danger opacity-20"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                        <h3 class="text-lg font-semibold mb-4">กิจกรรมล่าสุด</h3>
                        <div class="space-y-3">
                            <div class="flex items-center space-x-3 p-3 bg-gray-50 rounded-lg">
                                <i class="fas fa-plus-circle text-primary"></i>
                                <span class="text-gray-700">โรงเรียนใหม่ลงทะเบียนเข้าระบบ</span>
                                <span class="text-sm text-gray-500 ml-auto">2 ชั่วโมงที่แล้ว</span>
                            </div>
                            <div class="flex items-center space-x-3 p-3 bg-gray-50 rounded-lg">
                                <i class="fas fa-check-circle text-secondary"></i>
                                <span class="text-gray-700">อนุมัติโรงเรียนเรียบร้อยแล้ว</span>
                                <span class="text-sm text-gray-500 ml-auto">5 ชั่วโมงที่แล้ว</span>
                            </div>
                        </div>
                    </div>
                `;
            } else if (currentRole === 'teacher') {
                const teacherSubjects = subjects.filter(s => s.teacherId === currentUser.id);
                const teacherMaterials = materials.filter(m => m.teacherId === currentUser.id);
                const teacherGrades = grades.filter(g => g.teacherId === currentUser.id);
                
                return `
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                        <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-600">รายวิชาทั้งหมด</p>
                                    <p class="text-2xl font-bold text-primary">${teacherSubjects.length}</p>
                                </div>
                                <i class="fas fa-book text-3xl text-primary opacity-20"></i>
                            </div>
                        </div>
                        <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-600">สื่อการสอน</p>
                                    <p class="text-2xl font-bold text-secondary">${teacherMaterials.length}</p>
                                </div>
                                <i class="fas fa-file-upload text-3xl text-secondary opacity-20"></i>
                            </div>
                        </div>
                        <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-600">ผลการเรียน</p>
                                    <p class="text-2xl font-bold text-warning">${teacherGrades.length}</p>
                                </div>
                                <i class="fas fa-clipboard-list text-3xl text-warning opacity-20"></i>
                            </div>
                        </div>
                        <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-600">รอตรวจสอบ</p>
                                    <p class="text-2xl font-bold text-danger">${teacherGrades.filter(g => g.status === 'pending').length}</p>
                                </div>
                                <i class="fas fa-clock text-3xl text-danger opacity-20"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                        <h3 class="text-lg font-semibold mb-4">กิจกรรมล่าสุด</h3>
                        <div class="space-y-3">
                            <div class="flex items-center space-x-3 p-3 bg-gray-50 rounded-lg">
                                <i class="fas fa-plus-circle text-primary"></i>
                                <span class="text-gray-700">เพิ่มรายวิชาใหม่</span>
                                <span class="text-sm text-gray-500 ml-auto">1 ชั่วโมงที่แล้ว</span>
                            </div>
                            <div class="flex items-center space-x-3 p-3 bg-gray-50 rounded-lg">
                                <i class="fas fa-upload text-secondary"></i>
                                <span class="text-gray-700">อัปโหลดสื่อการสอน</span>
                                <span class="text-sm text-gray-500 ml-auto">3 ชั่วโมงที่แล้ว</span>
                            </div>
                        </div>
                    </div>
                `;
            } else if (currentRole === 'director') {
                const pendingGrades = grades.filter(g => g.status === 'pending');
                const approvedGrades = grades.filter(g => g.status === 'approved');
                
                return `
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                        <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-600">รอตรวจสอบ</p>
                                    <p class="text-2xl font-bold text-warning">${pendingGrades.length}</p>
                                </div>
                                <i class="fas fa-clock text-3xl text-warning opacity-20"></i>
                            </div>
                        </div>
                        <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-600">อนุมัติแล้ว</p>
                                    <p class="text-2xl font-bold text-secondary">${approvedGrades.length}</p>
                                </div>
                                <i class="fas fa-check-circle text-3xl text-secondary opacity-20"></i>
                            </div>
                        </div>
                        <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-600">ครูทั้งหมด</p>
                                    <p class="text-2xl font-bold text-primary">${users.filter(u => u.role === 'teacher' && u.schoolId === currentUser.schoolId).length}</p>
                                </div>
                                <i class="fas fa-users text-3xl text-primary opacity-20"></i>
                            </div>
                        </div>
                        <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-600">รายวิชาทั้งหมด</p>
                                    <p class="text-2xl font-bold text-info">${subjects.filter(s => s.schoolId === currentUser.schoolId).length}</p>
                                </div>
                                <i class="fas fa-book text-3xl text-info opacity-20"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                        <h3 class="text-lg font-semibold mb-4">กิจกรรมล่าสุด</h3>
                        <div class="space-y-3">
                            <div class="flex items-center space-x-3 p-3 bg-gray-50 rounded-lg">
                                <i class="fas fa-clipboard-check text-primary"></i>
                                <span class="text-gray-700">มีผลการเรียนใหม่รอตรวจสอบ</span>
                                <span class="text-sm text-gray-500 ml-auto">30 นาทีที่แล้ว</span>
                            </div>
                            <div class="flex items-center space-x-3 p-3 bg-gray-50 rounded-lg">
                                <i class="fas fa-check-circle text-secondary"></i>
                                <span class="text-gray-700">อนุมัติผลการเรียนเรียบร้อยแล้ว</span>
                                <span class="text-sm text-gray-500 ml-auto">2 ชั่วโมงที่แล้ว</span>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            return '<div class="text-center py-12"><p class="text-gray-500">ยินดีต้อนรับสู่ระบบ</p></div>';
        }

        // Get subjects content for teachers
        function getSubjectsContent() {
            const teacherSubjects = subjects.filter(s => s.teacherId === currentUser.id);
            
            return `
                <div class="bg-white rounded-lg shadow-sm border border-gray-200">
                    <div class="p-6 border-b border-gray-200">
                        <div class="flex justify-between items-center">
                            <h3 class="text-lg font-semibold">รายการวิชาที่สอน</h3>
                            <button onclick="showModal('addSubjectModal')" 
                                    class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-opacity-90 transition duration-200">
                                <i class="fas fa-plus mr-2"></i>เพิ่มรายวิชา
                            </button>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ชื่อวิชา</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ระดับชั้น</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ปีการศึกษา</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">การจัดการ</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                ${teacherSubjects.length > 0 ? teacherSubjects.map(subject => `
                                    <tr>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <div class="text-sm font-medium text-gray-900">${subject.name}</div>
                                            <div class="text-sm text-gray-500">${subject.description || '-'}</div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${subject.grade}</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${subject.year}</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                            <button onclick="editSubject(${subject.id})" 
                                                    class="text-primary hover:text-primary-dark mr-3">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button onclick="deleteSubject(${subject.id})" 
                                                    class="text-danger hover:text-red-700">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </td>
                                    </tr>
                                `).join('') : `
                                    <tr>
                                        <td colspan="4" class="px-6 py-12 text-center text-gray-500">
                                            <i class="fas fa-book text-4xl mb-4 opacity-20"></i>
                                            <p>ยังไม่มีรายวิชา</p>
                                            <p class="text-sm">คลิก "เพิ่มรายวิชา" เพื่อเริ่มต้น</p>
                                        </td>
                                    </tr>
                                `}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }

        // Get schools management content
        function getSchoolsContent() {
            return `
                <div class="bg-white rounded-lg shadow-sm border border-gray-200">
                    <div class="p-6 border-b border-gray-200">
                        <div class="flex justify-between items-center">
                            <h3 class="text-lg font-semibold">รายการโรงเรียน</h3>
                            <button onclick="showModal('addSchoolModal')" 
                                    class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-opacity-90 transition duration-200">
                                <i class="fas fa-plus mr-2"></i>เพิ่มโรงเรียน
                            </button>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ชื่อโรงเรียน</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">รหัส</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">สถานะ</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">การจัดการ</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                ${schools.map(school => `
                                    <tr>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <div class="text-sm font-medium text-gray-900">${school.name}</div>
                                            <div class="text-sm text-gray-500">${school.email || '-'}</div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${school.code}</td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span class="badge ${school.status === 'approved' ? 'bg-secondary text-white' : 'bg-warning text-gray-800'}">
                                                ${school.status === 'approved' ? 'อนุมัติแล้ว' : 'รออนุมัติ'}
                                            </span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                            <button onclick="viewSchool(${school.id})" 
                                                    class="text-info hover:text-blue-700 mr-3" title="ดูรายละเอียด">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                            <button onclick="editSchool(${school.id})" 
                                                    class="text-secondary hover:text-green-700 mr-3" title="แก้ไข">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            ${school.status === 'pending' ? `
                                                <button onclick="approveSchool(${school.id})" 
                                                        class="text-primary hover:text-primary-dark mr-3" title="อนุมัติ">
                                                    <i class="fas fa-check"></i>
                                                </button>
                                            ` : ''}
                                            <button onclick="deleteSchool(${school.id})" 
                                                    class="text-danger hover:text-red-700" title="ลบ">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }

        // Get users management content
        function getUsersContent() {
            return `
                <div class="bg-white rounded-lg shadow-sm border border-gray-200">
                    <div class="p-6 border-b border-gray-200">
                        <h3 class="text-lg font-semibold">รายการผู้ใช้</h3>
                    </div>
                    
                    <div class="table-container">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ชื่อ-นามสกุล</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ชื่อผู้ใช้</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">บทบาท</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">การจัดการ</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                ${users.map(user => `
                                    <tr>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <div class="text-sm font-medium text-gray-900">${user.firstName} ${user.lastName}</div>
                                            <div class="text-sm text-gray-500">${user.email || '-'}</div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${user.username}</td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span class="badge ${user.role === 'admin' ? 'bg-danger text-white' : user.role === 'teacher' ? 'bg-primary text-white' : 'bg-info text-white'}">
                                                ${getRoleText(user.role)}
                                            </span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                            <button onclick="editUser(${user.id})" 
                                                    class="text-primary hover:text-primary-dark mr-3">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            ${user.role !== 'admin' ? `
                                                <button onclick="deleteUser(${user.id})" 
                                                        class="text-danger hover:text-red-700">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            ` : ''}
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }

        // Approve school
        function approveSchool(schoolId) {
            const school = schools.find(s => s.id === schoolId);
            if (school) {
                school.status = 'approved';
                localStorage.setItem('schools', JSON.stringify(schools));
                Swal.fire({
                    title: 'อนุมัติสำเร็จ!',
                    text: 'อนุมัติโรงเรียนเรียบร้อยแล้ว',
                    icon: 'success',
                    timer: 2000,
                    showConfirmButton: false
                });
                loadPage('schools');
            }
        }

        // Delete school
        function deleteSchool(schoolId) {
            Swal.fire({
                title: 'ยืนยันการลบโรงเรียน',
                text: 'คุณต้องการลบโรงเรียนนี้หรือไม่? ข้อมูลทั้งหมดจะถูกลบอย่างถาวร',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#EF5350',
                cancelButtonColor: '#6B7280',
                confirmButtonText: 'ลบ',
                cancelButtonText: 'ยกเลิก',
                reverseButtons: true
            }).then((result) => {
                if (result.isConfirmed) {
                    schools = schools.filter(s => s.id !== schoolId);
                    users = users.filter(u => u.schoolId !== schoolId);
                    localStorage.setItem('schools', JSON.stringify(schools));
                    localStorage.setItem('users', JSON.stringify(users));
                    Swal.fire({
                        title: 'ลบสำเร็จ!',
                        text: 'ลบโรงเรียนเรียบร้อยแล้ว',
                        icon: 'success',
                        timer: 2000,
                        showConfirmButton: false
                    });
                    loadPage('schools');
                }
            });
        }

        // Delete user
        function deleteUser(userId) {
            const user = users.find(u => u.id === userId);
            const userName = user ? `${user.firstName} ${user.lastName}` : 'ผู้ใช้นี้';
            
            Swal.fire({
                title: 'ยืนยันการลบผู้ใช้',
                text: `คุณต้องการลบ "${userName}" หรือไม่?`,
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#EF5350',
                cancelButtonColor: '#6B7280',
                confirmButtonText: 'ลบ',
                cancelButtonText: 'ยกเลิก',
                reverseButtons: true
            }).then((result) => {
                if (result.isConfirmed) {
                    users = users.filter(u => u.id !== userId);
                    localStorage.setItem('users', JSON.stringify(users));
                    Swal.fire({
                        title: 'ลบสำเร็จ!',
                        text: 'ลบผู้ใช้เรียบร้อยแล้ว',
                        icon: 'success',
                        timer: 2000,
                        showConfirmButton: false
                    });
                    loadPage('users');
                }
            });
        }

        // Edit user (placeholder)
        function editUser(userId) {
            Swal.fire({
                title: 'ฟีเจอร์นี้กำลังพัฒนา',
                text: 'ขออภัย ฟีเจอร์นี้ยังไม่พร้อมใช้งาน',
                icon: 'info',
                confirmButtonColor: '#26A69A'
            });
        }

        // View school details
        function viewSchool(schoolId) {
            const school = schools.find(s => s.id === schoolId);
            if (school) {
                Swal.fire({
                    title: school.name,
                    html: `
                        <div class="text-left space-y-3">
                            <p><strong>รหัสโรงเรียน:</strong> ${school.code}</p>
                            <p><strong>อีเมล:</strong> ${school.email || '-'}</p>
                            <p><strong>เบอร์โทรศัพท์:</strong> ${school.phone || '-'}</p>
                            <p><strong>ที่อยู่:</strong> ${school.address || '-'}</p>
                            <p><strong>สถานะ:</strong> <span class="badge ${school.status === 'approved' ? 'bg-green-500' : 'bg-yellow-500'} text-white px-2 py-1 rounded">${school.status === 'approved' ? 'อนุมัติแล้ว' : 'รออนุมัติ'}</span></p>
                        </div>
                    `,
                    confirmButtonText: 'ปิด',
                    confirmButtonColor: '#26A69A'
                });
            }
        }

        // Edit school
        function editSchool(schoolId) {
            const school = schools.find(s => s.id === schoolId);
            if (school) {
                // Fill form with existing data
                document.getElementById('editSchoolId').value = school.id;
                document.getElementById('editSchoolName').value = school.name;
                document.getElementById('editSchoolCode').value = school.code;
                document.getElementById('editSchoolEmail').value = school.email || '';
                document.getElementById('editSchoolPhone').value = school.phone || '';
                document.getElementById('editSchoolAddress').value = school.address || '';
                
                showModal('editSchoolModal');
            }
        }

        // Add school form handler
        document.getElementById('addSchoolForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            try {
                const schoolName = document.getElementById('modalSchoolName').value.trim();
                const schoolCode = document.getElementById('modalSchoolCode').value.trim();
                
                if (!schoolName || !schoolCode) {
                    Swal.fire({
                        title: 'ข้อผิดพลาด!',
                        text: 'กรุณากรอกข้อมูลให้ครบถ้วน',
                        icon: 'error',
                        confirmButtonColor: '#EF5350'
                    });
                    return;
                }
                
                const schoolData = {
                    id: Date.now(),
                    name: schoolName,
                    code: schoolCode,
                    email: '',
                    address: '',
                    phone: '',
                    status: 'approved'
                };
                
                schools.push(schoolData);
                localStorage.setItem('schools', JSON.stringify(schools));
                
                closeModal('addSchoolModal');
                Swal.fire({
                    title: 'เพิ่มสำเร็จ!',
                    text: 'เพิ่มโรงเรียนเรียบร้อยแล้ว',
                    icon: 'success',
                    timer: 2000,
                    showConfirmButton: false
                });
                
                // Reset form
                document.getElementById('addSchoolForm').reset();
                
                // โหลดหน้าใหม่
                loadPage('schools');
                
            } catch (error) {
                Swal.fire({
                    title: 'ข้อผิดพลาด!',
                    text: 'เกิดข้อผิดพลาดในการเพิ่มโรงเรียน',
                    icon: 'error',
                    confirmButtonColor: '#EF5350'
                });
            }
        });

        // Add subject form handler
        document.getElementById('addSubjectForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            try {
                const subjectName = document.getElementById('subjectName').value.trim();
                const subjectGrade = document.getElementById('subjectGrade').value;
                const subjectYear = document.getElementById('subjectYear').value.trim();
                
                if (!subjectName || !subjectGrade || !subjectYear) {
                    Swal.fire({
                        title: 'ข้อผิดพลาด!',
                        text: 'กรุณากรอกข้อมูลให้ครบถ้วน',
                        icon: 'error',
                        confirmButtonColor: '#EF5350'
                    });
                    return;
                }
                
                const subjectData = {
                    id: Date.now(),
                    name: subjectName,
                    grade: subjectGrade,
                    year: subjectYear,
                    description: document.getElementById('subjectDescription').value.trim(),
                    teacherId: currentUser.id,
                    schoolId: currentUser.schoolId || 1
                };
                
                subjects.push(subjectData);
                localStorage.setItem('subjects', JSON.stringify(subjects));
                
                closeModal('addSubjectModal');
                Swal.fire({
                    title: 'เพิ่มสำเร็จ!',
                    text: 'เพิ่มรายวิชาเรียบร้อยแล้ว',
                    icon: 'success',
                    timer: 2000,
                    showConfirmButton: false
                });
                
                // Reset form
                document.getElementById('addSubjectForm').reset();
                
                // โหลดหน้าใหม่
                loadPage('subjects');
                
            } catch (error) {
                Swal.fire({
                    title: 'ข้อผิดพลาด!',
                    text: 'เกิดข้อผิดพลาดในการเพิ่มรายวิชา',
                    icon: 'error',
                    confirmButtonColor: '#EF5350'
                });
            }
        });

        // Subject management functions
        function editSubject(subjectId) {
            Swal.fire({
                title: 'ฟีเจอร์นี้กำลังพัฒนา',
                text: 'ขออภัย ฟีเจอร์นี้ยังไม่พร้อมใช้งาน',
                icon: 'info',
                confirmButtonColor: '#26A69A'
            });
        }

        function deleteSubject(subjectId) {
            const subject = subjects.find(s => s.id === subjectId);
            const subjectName = subject ? subject.name : 'รายวิชานี้';
            
            Swal.fire({
                title: 'ยืนยันการลบรายวิชา',
                text: `คุณต้องการลบรายวิชา "${subjectName}" หรือไม่?`,
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#EF5350',
                cancelButtonColor: '#6B7280',
                confirmButtonText: 'ลบ',
                cancelButtonText: 'ยกเลิก',
                reverseButtons: true
            }).then((result) => {
                if (result.isConfirmed) {
                    subjects = subjects.filter(s => s.id !== subjectId);
                    localStorage.setItem('subjects', JSON.stringify(subjects));
                    Swal.fire({
                        title: 'ลบสำเร็จ!',
                        text: 'ลบรายวิชาเรียบร้อยแล้ว',
                        icon: 'success',
                        timer: 2000,
                        showConfirmButton: false
                    });
                    loadPage('subjects');
                }
            });
        }

        // Get materials content for teachers
        function getMaterialsContent() {
            const teacherMaterials = materials.filter(m => m.teacherId === currentUser.id);
            
            return `
                <div class="bg-white rounded-lg shadow-sm border border-gray-200">
                    <div class="p-6 border-b border-gray-200">
                        <div class="flex justify-between items-center">
                            <h3 class="text-lg font-semibold">สื่อการสอน</h3>
                            <button onclick="showAddMaterialModal()" 
                                    class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-opacity-90 transition duration-200">
                                <i class="fas fa-plus mr-2"></i>เพิ่มสื่อการสอน
                            </button>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ชื่อสื่อ</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">รายวิชา</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ประเภท</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">วันที่อัปโหลด</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">การจัดการ</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                ${teacherMaterials.length > 0 ? teacherMaterials.map(material => {
                                    const subject = subjects.find(s => s.id === material.subjectId);
                                    return `
                                        <tr>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <div class="text-sm font-medium text-gray-900">${material.name}</div>
                                                <div class="text-sm text-gray-500">${material.description || '-'}</div>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${subject ? subject.name : '-'}</td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <span class="badge ${getTypeColor(material.type)} text-white">
                                                    ${material.type}
                                                </span>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${material.uploadDate || 'วันนี้'}</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                                <button onclick="viewMaterial(${material.id})" 
                                                        class="text-primary hover:text-primary-dark mr-3">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                                <button onclick="editMaterial(${material.id})" 
                                                        class="text-secondary hover:text-secondary-dark mr-3">
                                                    <i class="fas fa-edit"></i>
                                                </button>
                                                <button onclick="deleteMaterial(${material.id})" 
                                                        class="text-danger hover:text-red-700">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </td>
                                        </tr>
                                    `;
                                }).join('') : `
                                    <tr>
                                        <td colspan="5" class="px-6 py-12 text-center text-gray-500">
                                            <i class="fas fa-file-upload text-4xl mb-4 opacity-20"></i>
                                            <p>ยังไม่มีสื่อการสอน</p>
                                            <p class="text-sm">คลิก "เพิ่มสื่อการสอน" เพื่อเริ่มต้น</p>
                                        </td>
                                    </tr>
                                `}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }

        // Get grades content for teachers
        function getGradesContent() {
            const teacherGrades = grades.filter(g => g.teacherId === currentUser.id);
            
            return `
                <div class="bg-white rounded-lg shadow-sm border border-gray-200">
                    <div class="p-6 border-b border-gray-200">
                        <div class="flex justify-between items-center">
                            <h3 class="text-lg font-semibold">ผลการเรียน</h3>
                            <button onclick="showAddGradeModal()" 
                                    class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-opacity-90 transition duration-200">
                                <i class="fas fa-plus mr-2"></i>เพิ่มผลการเรียน
                            </button>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">นักเรียน</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">รายวิชา</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">กลางภาค</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ปลายภาค</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">งาน</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">เข้าร่วม</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">รวม</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">เกรด</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">สถานะ</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">การจัดการ</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                ${teacherGrades.length > 0 ? teacherGrades.map(grade => {
                                    const subject = subjects.find(s => s.id === grade.subjectId);
                                    return `
                                        <tr>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <div class="text-sm font-medium text-gray-900">${grade.studentName}</div>
                                                <div class="text-sm text-gray-500">รหัส: ${grade.studentId}</div>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${subject ? subject.name : '-'}</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${grade.midtermScore || '-'}</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${grade.finalScore || '-'}</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${grade.assignmentScore || '-'}</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${grade.participationScore || '-'}</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${grade.totalScore || '-'}</td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <span class="badge ${getGradeColor(grade.grade)} text-white">
                                                    ${grade.grade || '-'}
                                                </span>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <span class="badge ${grade.status === 'approved' ? 'bg-secondary text-white' : grade.status === 'rejected' ? 'bg-danger text-white' : 'bg-warning text-gray-800'}">
                                                    ${getStatusText(grade.status)}
                                                </span>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                                <button onclick="viewGrade(${grade.id})" 
                                                        class="text-primary hover:text-primary-dark mr-3">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                                <button onclick="editGrade(${grade.id})" 
                                                        class="text-secondary hover:text-secondary-dark mr-3">
                                                    <i class="fas fa-edit"></i>
                                                </button>
                                                <button onclick="deleteGrade(${grade.id})" 
                                                        class="text-danger hover:text-red-700">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </td>
                                        </tr>
                                    `;
                                }).join('') : `
                                    <tr>
                                        <td colspan="10" class="px-6 py-12 text-center text-gray-500">
                                            <i class="fas fa-clipboard-list text-4xl mb-4 opacity-20"></i>
                                            <p>ยังไม่มีผลการเรียน</p>
                                            <p class="text-sm">คลิก "เพิ่มผลการเรียน" เพื่อเริ่มต้น</p>
                                        </td>
                                    </tr>
                                `}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }

        // Get evaluations content for teachers
        function getEvaluationsContent() {
            const teacherEvaluations = evaluations.filter(e => e.teacherId === currentUser.id);
            
            return `
                <div class="bg-white rounded-lg shadow-sm border border-gray-200">
                    <div class="p-6 border-b border-gray-200">
                        <div class="flex justify-between items-center">
                            <h3 class="text-lg font-semibold">แบบประเมิน</h3>
                            <button onclick="showAddEvaluationModal()" 
                                    class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-opacity-90 transition duration-200">
                                <i class="fas fa-plus mr-2"></i>สร้างแบบประเมิน
                            </button>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ชื่อแบบประเมิน</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">รายวิชา</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ประเภท</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">คะแนนเต็ม</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">กำหนดส่ง</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">การจัดการ</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                ${teacherEvaluations.length > 0 ? teacherEvaluations.map(evaluation => {
                                    const subject = subjects.find(s => s.id === evaluation.subjectId);
                                    return `
                                        <tr>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <div class="text-sm font-medium text-gray-900">${evaluation.title}</div>
                                                <div class="text-sm text-gray-500">${evaluation.description || '-'}</div>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${subject ? subject.name : '-'}</td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <span class="badge ${getEvaluationTypeColor(evaluation.type)} text-white">
                                                    ${getEvaluationTypeText(evaluation.type)}
                                                </span>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${evaluation.maxScore} คะแนน</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${evaluation.dueDate ? formatDate(evaluation.dueDate) : '-'}</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                                <button onclick="viewEvaluation(${evaluation.id})" 
                                                        class="text-primary hover:text-primary-dark mr-3">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                                <button onclick="editEvaluation(${evaluation.id})" 
                                                        class="text-secondary hover:text-secondary-dark mr-3">
                                                    <i class="fas fa-edit"></i>
                                                </button>
                                                <button onclick="deleteEvaluation(${evaluation.id})" 
                                                        class="text-danger hover:text-red-700">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </td>
                                        </tr>
                                    `;
                                }).join('') : `
                                    <tr>
                                        <td colspan="6" class="px-6 py-12 text-center text-gray-500">
                                            <i class="fas fa-clipboard-list text-4xl mb-4 opacity-20"></i>
                                            <p>ยังไม่มีแบบประเมิน</p>
                                            <p class="text-sm">คลิก "สร้างแบบประเมิน" เพื่อเริ่มต้น</p>
                                        </td>
                                    </tr>
                                `}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }

        // Get approve grades content for directors
        function getApproveGradesContent() {
            const schoolGrades = grades.filter(g => {
                const teacher = users.find(u => u.id === g.teacherId);
                return teacher && teacher.schoolId === currentUser.schoolId;
            });
            
            return `
                <div class="bg-white rounded-lg shadow-sm border border-gray-200">
                    <div class="p-6 border-b border-gray-200">
                        <h3 class="text-lg font-semibold">ตรวจสอบผลการเรียน</h3>
                        <p class="text-sm text-gray-600 mt-1">ตรวจสอบและอนุมัติผลการเรียนจากครูในโรงเรียน</p>
                    </div>
                    
                    <div class="table-container">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">นักเรียน</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">รายวิชา</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ครูผู้สอน</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">คะแนนรวม</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">เกรด</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">สถานะ</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">การจัดการ</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                ${schoolGrades.length > 0 ? schoolGrades.map(grade => {
                                    const subject = subjects.find(s => s.id === grade.subjectId);
                                    const teacher = users.find(u => u.id === grade.teacherId);
                                    return `
                                        <tr>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <div class="text-sm font-medium text-gray-900">${grade.studentName}</div>
                                                <div class="text-sm text-gray-500">รหัส: ${grade.studentId}</div>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${subject ? subject.name : '-'}</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${teacher ? `${teacher.firstName} ${teacher.lastName}` : '-'}</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${grade.totalScore || '-'}</td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <span class="badge ${getGradeColor(grade.grade)} text-white">
                                                    ${grade.grade || '-'}
                                                </span>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <span class="badge ${grade.status === 'approved' ? 'bg-secondary text-white' : grade.status === 'rejected' ? 'bg-danger text-white' : 'bg-warning text-gray-800'}">
                                                    ${getStatusText(grade.status)}
                                                </span>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                                <button onclick="viewGradeDetails(${grade.id})" 
                                                        class="text-primary hover:text-primary-dark mr-3" title="ดูรายละเอียด">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                                ${grade.status === 'pending' ? `
                                                    <button onclick="approveGrade(${grade.id})" 
                                                            class="text-secondary hover:text-secondary-dark mr-3" title="อนุมัติ">
                                                        <i class="fas fa-check"></i>
                                                    </button>
                                                    <button onclick="rejectGrade(${grade.id})" 
                                                            class="text-danger hover:text-red-700" title="ไม่อนุมัติ">
                                                        <i class="fas fa-times"></i>
                                                    </button>
                                                ` : ''}
                                            </td>
                                        </tr>
                                    `;
                                }).join('') : `
                                    <tr>
                                        <td colspan="7" class="px-6 py-12 text-center text-gray-500">
                                            <i class="fas fa-clipboard-check text-4xl mb-4 opacity-20"></i>
                                            <p>ไม่มีผลการเรียนที่ต้องตรวจสอบ</p>
                                        </td>
                                    </tr>
                                `}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }

        // Get approve reports content for directors
        function getApproveReportsContent() {
            const schoolTeachers = users.filter(u => u.role === 'teacher' && u.schoolId === currentUser.schoolId);
            
            return `
                <div class="bg-white rounded-lg shadow-sm border border-gray-200">
                    <div class="p-6 border-b border-gray-200">
                        <h3 class="text-lg font-semibold">อนุมัติรายงานผล</h3>
                        <p class="text-sm text-gray-600 mt-1">อนุมัติรายงานผลการเรียนรู้จากครูแต่ละคน</p>
                    </div>
                    
                    <div class="grid gap-6 p-6">
                        ${schoolTeachers.length > 0 ? schoolTeachers.map(teacher => {
                            const teacherSubjects = subjects.filter(s => s.teacherId === teacher.id);
                            const teacherGrades = grades.filter(g => g.teacherId === teacher.id);
                            const pendingGrades = teacherGrades.filter(g => g.status === 'pending');
                            const approvedGrades = teacherGrades.filter(g => g.status === 'approved');
                            
                            return `
                                <div class="border border-gray-200 rounded-lg p-6">
                                    <div class="flex justify-between items-start mb-4">
                                        <div>
                                            <h4 class="text-lg font-medium text-gray-900">${teacher.firstName} ${teacher.lastName}</h4>
                                            <p class="text-sm text-gray-600">${teacher.email || '-'}</p>
                                        </div>
                                        <div class="text-right">
                                            <div class="text-sm text-gray-500">รายวิชาที่สอน: ${teacherSubjects.length}</div>
                                            <div class="text-sm text-gray-500">ผลการเรียนทั้งหมด: ${teacherGrades.length}</div>
                                        </div>
                                    </div>
                                    
                                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4">
                                        <div class="text-center p-3 bg-yellow-50 rounded-lg">
                                            <div class="text-2xl font-bold text-yellow-600">${pendingGrades.length}</div>
                                            <div class="text-sm text-yellow-600">รอตรวจสอบ</div>
                                        </div>
                                        <div class="text-center p-3 bg-green-50 rounded-lg">
                                            <div class="text-2xl font-bold text-green-600">${approvedGrades.length}</div>
                                            <div class="text-sm text-green-600">อนุมัติแล้ว</div>
                                        </div>
                                        <div class="text-center p-3 bg-blue-50 rounded-lg">
                                            <div class="text-2xl font-bold text-blue-600">${teacherSubjects.length}</div>
                                            <div class="text-sm text-blue-600">รายวิชา</div>
                                        </div>
                                        <div class="text-center p-3 bg-purple-50 rounded-lg">
                                            <div class="text-2xl font-bold text-purple-600">${materials.filter(m => m.teacherId === teacher.id).length}</div>
                                            <div class="text-sm text-purple-600">สื่อการสอน</div>
                                        </div>
                                    </div>
                                    
                                    <div class="flex justify-end space-x-3">
                                        <button onclick="viewTeacherReport(${teacher.id})" 
                                                class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-opacity-90 transition duration-200">
                                            <i class="fas fa-chart-bar mr-2"></i>ดูรายงาน
                                        </button>
                                        ${pendingGrades.length > 0 ? `
                                            <button onclick="approveAllTeacherGrades(${teacher.id})" 
                                                    class="px-4 py-2 bg-secondary text-white rounded-lg hover:bg-opacity-90 transition duration-200">
                                                <i class="fas fa-check-double mr-2"></i>อนุมัติทั้งหมด
                                            </button>
                                        ` : ''}
                                    </div>
                                </div>
                            `;
                        }).join('') : `
                            <div class="text-center py-12 text-gray-500">
                                <i class="fas fa-users text-4xl mb-4 opacity-20"></i>
                                <p>ไม่มีครูในโรงเรียน</p>
                            </div>
                        `}
                    </div>
                </div>
            `;
        }

        // Get school info content for directors
        function getSchoolInfoContent() {
            const school = schools.find(s => s.id === currentUser.schoolId);
            if (!school) {
                return '<div class="text-center py-12"><p class="text-gray-500">ไม่พบข้อมูลโรงเรียน</p></div>';
            }

            return `
                <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-lg font-semibold">ข้อมูลโรงเรียน</h3>
                        <button onclick="editSchoolInfo()" 
                                class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-opacity-90 transition duration-200">
                            <i class="fas fa-edit mr-2"></i>แก้ไขข้อมูล
                        </button>
                    </div>
                    
                    <div class="grid md:grid-cols-2 gap-6">
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">ชื่อโรงเรียน</label>
                                <p class="text-gray-900">${school.name}</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">รหัสโรงเรียน</label>
                                <p class="text-gray-900">${school.code}</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">เบอร์โทรศัพท์</label>
                                <p class="text-gray-900">${school.phone || '-'}</p>
                            </div>
                        </div>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">อีเมลโรงเรียน</label>
                                <p class="text-gray-900">${school.email || '-'}</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">ที่อยู่</label>
                                <p class="text-gray-900">${school.address || '-'}</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">สถานะ</label>
                                <span class="badge ${school.status === 'approved' ? 'bg-secondary text-white' : 'bg-warning text-gray-800'}">
                                    ${school.status === 'approved' ? 'อนุมัติแล้ว' : 'รออนุมัติ'}
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Get teacher summary content for directors
        function getTeacherSummaryContent() {
            const schoolTeachers = users.filter(u => u.role === 'teacher' && u.schoolId === currentUser.schoolId);
            
            return `
                <div class="space-y-6">
                    <!-- Summary Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-600">ครูทั้งหมด</p>
                                    <p class="text-2xl font-bold text-primary">${schoolTeachers.length}</p>
                                </div>
                                <i class="fas fa-users text-3xl text-primary opacity-20"></i>
                            </div>
                        </div>
                        <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-600">รายวิชาทั้งหมด</p>
                                    <p class="text-2xl font-bold text-secondary">${subjects.filter(s => s.schoolId === currentUser.schoolId).length}</p>
                                </div>
                                <i class="fas fa-book text-3xl text-secondary opacity-20"></i>
                            </div>
                        </div>
                        <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-600">สื่อการสอน</p>
                                    <p class="text-2xl font-bold text-warning">${materials.filter(m => {
                                        const teacher = users.find(u => u.id === m.teacherId);
                                        return teacher && teacher.schoolId === currentUser.schoolId;
                                    }).length}</p>
                                </div>
                                <i class="fas fa-file-upload text-3xl text-warning opacity-20"></i>
                            </div>
                        </div>
                        <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-600">ผลการเรียน</p>
                                    <p class="text-2xl font-bold text-info">${grades.filter(g => {
                                        const teacher = users.find(u => u.id === g.teacherId);
                                        return teacher && teacher.schoolId === currentUser.schoolId;
                                    }).length}</p>
                                </div>
                                <i class="fas fa-clipboard-list text-3xl text-info opacity-20"></i>
                            </div>
                        </div>
                    </div>

                    <!-- Teachers Management -->
                    <div class="bg-white rounded-lg shadow-sm border border-gray-200">
                        <div class="p-6 border-b border-gray-200">
                            <div class="flex justify-between items-center">
                                <h3 class="text-lg font-semibold">จัดการครู</h3>
                                <button onclick="showAddTeacherModal()" 
                                        class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-opacity-90 transition duration-200">
                                    <i class="fas fa-plus mr-2"></i>เพิ่มครู
                                </button>
                            </div>
                        </div>
                        
                        <div class="table-container">
                            <table class="w-full">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ชื่อ-นามสกุล</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">อีเมล</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">รายวิชา</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">สื่อการสอน</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ผลการเรียน</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">การจัดการ</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    ${schoolTeachers.length > 0 ? schoolTeachers.map(teacher => {
                                        const teacherSubjects = subjects.filter(s => s.teacherId === teacher.id);
                                        const teacherMaterials = materials.filter(m => m.teacherId === teacher.id);
                                        const teacherGrades = grades.filter(g => g.teacherId === teacher.id);
                                        
                                        return `
                                            <tr>
                                                <td class="px-6 py-4 whitespace-nowrap">
                                                    <div class="text-sm font-medium text-gray-900">${teacher.firstName} ${teacher.lastName}</div>
                                                    <div class="text-sm text-gray-500">ชื่อผู้ใช้: ${teacher.username}</div>
                                                </td>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${teacher.email || '-'}</td>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${teacherSubjects.length}</td>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${teacherMaterials.length}</td>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${teacherGrades.length}</td>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                                    <button onclick="viewTeacherDetails(${teacher.id})" 
                                                            class="text-primary hover:text-primary-dark mr-3" title="ดูรายละเอียด">
                                                        <i class="fas fa-eye"></i>
                                                    </button>
                                                    <button onclick="editTeacher(${teacher.id})" 
                                                            class="text-secondary hover:text-secondary-dark mr-3" title="แก้ไข">
                                                        <i class="fas fa-edit"></i>
                                                    </button>
                                                    <button onclick="deleteTeacher(${teacher.id})" 
                                                            class="text-danger hover:text-red-700" title="ลบ">
                                                        <i class="fas fa-trash"></i>
                                                    </button>
                                                </td>
                                            </tr>
                                        `;
                                    }).join('') : `
                                        <tr>
                                            <td colspan="6" class="px-6 py-12 text-center text-gray-500">
                                                <i class="fas fa-users text-4xl mb-4 opacity-20"></i>
                                                <p>ยังไม่มีครูในโรงเรียน</p>
                                                <p class="text-sm">คลิก "เพิ่มครู" เพื่อเริ่มต้น</p>
                                            </td>
                                        </tr>
                                    `}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
        }

        // Get settings content for admin
        function getSettingsContent() {
            return `
                <div class="max-w-2xl mx-auto">
                    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                        <h3 class="text-lg font-semibold mb-6">ตั้งค่าระบบ</h3>
                        
                        <form id="settingsForm" class="space-y-6">
                            <div>
                                <label for="systemNameInput" class="block text-sm font-medium text-gray-700 mb-2">ชื่อระบบ</label>
                                <input type="text" id="systemNameInput" value="${systemSettings.systemName || ''}" 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                            </div>
                            
                            <div class="flex justify-end space-x-3 pt-4">
                                <button type="button" onclick="resetSettings()" 
                                        class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50">
                                    รีเซ็ตค่าเริ่มต้น
                                </button>
                                <button type="submit" 
                                        class="px-6 py-2 bg-primary text-white rounded-lg hover:bg-opacity-90">
                                    บันทึกการตั้งค่า
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            `;
        }

        // Get reports content for admin
        function getReportsContent() {
            return `
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                        <h3 class="text-lg font-semibold mb-4">สถิติโรงเรียน</h3>
                        <div class="space-y-4">
                            <div class="flex justify-between items-center">
                                <span class="text-gray-600">โรงเรียนทั้งหมด</span>
                                <span class="font-semibold text-primary">${schools.length}</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-gray-600">โรงเรียนที่อนุมัติแล้ว</span>
                                <span class="font-semibold text-secondary">${schools.filter(s => s.status === 'approved').length}</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-gray-600">รออนุมัติ</span>
                                <span class="font-semibold text-warning">${schools.filter(s => s.status === 'pending').length}</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                        <h3 class="text-lg font-semibold mb-4">สถิติผู้ใช้</h3>
                        <div class="space-y-4">
                            <div class="flex justify-between items-center">
                                <span class="text-gray-600">ผู้ดูแลระบบ</span>
                                <span class="font-semibold text-danger">${users.filter(u => u.role === 'admin').length}</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-gray-600">ผู้อำนวยการ</span>
                                <span class="font-semibold text-info">${users.filter(u => u.role === 'director').length}</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-gray-600">ครู</span>
                                <span class="font-semibold text-primary">${users.filter(u => u.role === 'teacher').length}</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Get academic years content
        function getAcademicYearsContent() {
            const canManage = currentRole === 'teacher' || currentRole === 'director';
            const isAdmin = currentRole === 'admin';
            
            return `
                <div class="bg-white rounded-lg shadow-sm border border-gray-200">
                    <div class="p-6 border-b border-gray-200">
                        <div class="flex justify-between items-center">
                            <div>
                                <h3 class="text-lg font-semibold">รายการปีการศึกษา</h3>
                                ${isAdmin ? '<p class="text-sm text-gray-600 mt-1">ดูข้อมูลและติดตามการเปลี่ยนแปลง</p>' : ''}
                            </div>
                            ${canManage ? `
                                <button onclick="showModal('addAcademicYearModal')" 
                                        class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-opacity-90 transition duration-200">
                                    <i class="fas fa-plus mr-2"></i>เพิ่มปีการศึกษา
                                </button>
                            ` : ''}
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ปีการศึกษา</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">วันที่เริ่มต้น</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">วันที่สิ้นสุด</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">สถานะ</th>
                                    ${isAdmin ? '<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ผู้สร้าง</th>' : ''}
                                    ${isAdmin ? '<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">แก้ไขล่าสุด</th>' : ''}
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">การจัดการ</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                ${academicYears.length > 0 ? academicYears.map(year => {
                                    const creator = users.find(u => u.id === year.createdBy);
                                    const editor = users.find(u => u.id === year.lastEditedBy);
                                    return `
                                        <tr>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <div class="text-sm font-medium text-gray-900">${year.year}</div>
                                                <div class="text-sm text-gray-500">${year.description || '-'}</div>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${formatDateOnly(year.startDate)}</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${formatDateOnly(year.endDate)}</td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <span class="badge ${getAcademicStatusColor(year.status)} text-white">
                                                    ${getAcademicStatusText(year.status)}
                                                </span>
                                            </td>
                                            ${isAdmin ? `
                                                <td class="px-6 py-4 whitespace-nowrap">
                                                    <div class="text-sm text-gray-900">${creator ? `${creator.firstName} ${creator.lastName}` : '-'}</div>
                                                    <div class="text-xs text-gray-500">${year.createdAt ? formatDateTime(year.createdAt) : '-'}</div>
                                                </td>
                                            ` : ''}
                                            ${isAdmin ? `
                                                <td class="px-6 py-4 whitespace-nowrap">
                                                    <div class="text-sm text-gray-900">${editor ? `${editor.firstName} ${editor.lastName}` : '-'}</div>
                                                    <div class="text-xs text-gray-500">${year.lastEditedAt ? formatDateTime(year.lastEditedAt) : '-'}</div>
                                                </td>
                                            ` : ''}
                                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                                <button onclick="viewAcademicYearDetails(${year.id})" 
                                                        class="text-info hover:text-blue-700 mr-3" title="ดูรายละเอียด">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                                ${canManage ? `
                                                    <button onclick="editAcademicYear(${year.id})" 
                                                            class="text-primary hover:text-primary-dark mr-3" title="แก้ไข">
                                                        <i class="fas fa-edit"></i>
                                                    </button>
                                                    ${year.status !== 'active' ? `
                                                        <button onclick="deleteAcademicYear(${year.id})" 
                                                                class="text-danger hover:text-red-700" title="ลบ">
                                                            <i class="fas fa-trash"></i>
                                                        </button>
                                                    ` : ''}
                                                ` : ''}
                                            </td>
                                        </tr>
                                    `;
                                }).join('') : `
                                    <tr>
                                        <td colspan="${isAdmin ? '7' : '5'}" class="px-6 py-12 text-center text-gray-500">
                                            <i class="fas fa-calendar-alt text-4xl mb-4 opacity-20"></i>
                                            <p>ยังไม่มีปีการศึกษา</p>
                                            ${canManage ? '<p class="text-sm">คลิก "เพิ่มปีการศึกษา" เพื่อเริ่มต้น</p>' : ''}
                                        </td>
                                    </tr>
                                `}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }

        // Edit school info function
        function editSchoolInfo() {
            Swal.fire({
                title: 'ฟีเจอร์นี้กำลังพัฒนา',
                text: 'ขออภัย ฟีเจอร์นี้ยังไม่พร้อมใช้งาน',
                icon: 'info',
                confirmButtonColor: '#26A69A'
            });
        }

        // Show register page
        function showRegisterPage() {
            document.getElementById('loginPage').classList.add('hidden');
            document.getElementById('registerPage').classList.remove('hidden');
        }

        // Show login page
        function showLoginPage() {
            document.getElementById('registerPage').classList.add('hidden');
            document.getElementById('loginPage').classList.remove('hidden');
        }

        // Logout
        function logout() {
            currentUser = null;
            currentRole = null;
            document.getElementById('dashboardLayout').classList.add('hidden');
            document.getElementById('loginPage').classList.remove('hidden');
            
            // Reset login form
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            document.getElementById('selectedUserType').value = '';
            
            // Reset user type buttons
            document.querySelectorAll('.user-type-btn').forEach(btn => {
                btn.classList.remove('border-primary', 'bg-primary', 'bg-opacity-10');
                btn.classList.add('border-gray-200');
                const icon = btn.querySelector('i');
                const text = btn.querySelector('span');
                icon.classList.remove('text-primary');
                icon.classList.add('text-gray-400');
                text.classList.remove('text-primary');
                text.classList.add('text-gray-700');
            });
            
            showToast('ออกจากระบบ', 'ออกจากระบบเรียบร้อยแล้ว');
        }

        // Mobile menu toggle
        document.getElementById('mobileMenuBtn').addEventListener('click', function() {
            const sidebar = document.getElementById('sidebar');
            const hamburgerIcon = this.querySelector('.hamburger-icon');
            
            sidebar.classList.toggle('open');
            hamburgerIcon.classList.toggle('active');
        });

        // Close mobile menu when clicking outside
        document.addEventListener('click', function(e) {
            const sidebar = document.getElementById('sidebar');
            const mobileMenuBtn = document.getElementById('mobileMenuBtn');
            const hamburgerIcon = mobileMenuBtn.querySelector('.hamburger-icon');
            
            if (!sidebar.contains(e.target) && !mobileMenuBtn.contains(e.target)) {
                sidebar.classList.remove('open');
                hamburgerIcon.classList.remove('active');
            }
        });

        // Close modals when clicking outside
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('modal')) {
                e.target.classList.remove('show');
            }
        });

        // Material management functions
        function showAddMaterialModal() {
            // Populate subject dropdown
            const materialSubject = document.getElementById('materialSubject');
            const teacherSubjects = subjects.filter(s => s.teacherId === currentUser.id);
            
            materialSubject.innerHTML = '<option value="">เลือกรายวิชา</option>' +
                teacherSubjects.map(subject => `<option value="${subject.id}">${subject.name} (${subject.grade})</option>`).join('');
            
            showModal('addMaterialModal');
        }

        function showAddEvaluationModal() {
            // Populate subject dropdown
            const evaluationSubject = document.getElementById('evaluationSubject');
            const teacherSubjects = subjects.filter(s => s.teacherId === currentUser.id);
            
            evaluationSubject.innerHTML = '<option value="">เลือกรายวิชา</option>' +
                teacherSubjects.map(subject => `<option value="${subject.id}">${subject.name} (${subject.grade})</option>`).join('');
            
            showModal('addEvaluationModal');
        }

        // Add material form handler
        document.getElementById('addMaterialForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            try {
                const materialTitle = document.getElementById('materialTitle').value.trim();
                const materialSubject = document.getElementById('materialSubject').value;
                const materialType = document.getElementById('materialType').value;
                
                if (!materialTitle || !materialSubject || !materialType) {
                    Swal.fire({
                        title: 'ข้อผิดพลาด!',
                        text: 'กรุณากรอกข้อมูลให้ครบถ้วน',
                        icon: 'error',
                        confirmButtonColor: '#EF5350'
                    });
                    return;
                }
                
                const materialData = {
                    id: Date.now(),
                    name: materialTitle,
                    type: materialType,
                    subjectId: parseInt(materialSubject),
                    teacherId: currentUser.id,
                    description: document.getElementById('materialDescription').value.trim(),
                    url: document.getElementById('materialUrl').value.trim() || '#',
                    uploadDate: new Date().toISOString().split('T')[0]
                };
                
                materials.push(materialData);
                localStorage.setItem('materials', JSON.stringify(materials));
                
                closeModal('addMaterialModal');
                Swal.fire({
                    title: 'เพิ่มสำเร็จ!',
                    text: 'เพิ่มสื่อการสอนเรียบร้อยแล้ว',
                    icon: 'success',
                    timer: 2000,
                    showConfirmButton: false
                });
                
                // Reset form
                document.getElementById('addMaterialForm').reset();
                
                // Reload page
                loadPage('materials');
                
            } catch (error) {
                Swal.fire({
                    title: 'ข้อผิดพลาด!',
                    text: 'เกิดข้อผิดพลาดในการเพิ่มสื่อการสอน',
                    icon: 'error',
                    confirmButtonColor: '#EF5350'
                });
            }
        });

        // Add evaluation form handler
        document.getElementById('addEvaluationForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            try {
                const evaluationTitle = document.getElementById('evaluationTitle').value.trim();
                const evaluationSubject = document.getElementById('evaluationSubject').value;
                const evaluationType = document.getElementById('evaluationType').value;
                
                if (!evaluationTitle || !evaluationSubject || !evaluationType) {
                    Swal.fire({
                        title: 'ข้อผิดพลาด!',
                        text: 'กรุณากรอกข้อมูลให้ครบถ้วน',
                        icon: 'error',
                        confirmButtonColor: '#EF5350'
                    });
                    return;
                }
                
                // Collect criteria
                const criteriaItems = document.querySelectorAll('.criteria-item');
                const criteria = [];
                criteriaItems.forEach(item => {
                    const title = item.querySelector('.criteria-title').value.trim();
                    const score = parseInt(item.querySelector('.criteria-score').value);
                    if (title && score) {
                        criteria.push({ title, score });
                    }
                });
                
                const evaluationData = {
                    id: Date.now(),
                    title: evaluationTitle,
                    type: evaluationType,
                    subjectId: parseInt(evaluationSubject),
                    teacherId: currentUser.id,
                    description: document.getElementById('evaluationDescription').value.trim(),
                    maxScore: parseInt(document.getElementById('evaluationScore').value),
                    weight: parseInt(document.getElementById('evaluationWeight').value),
                    dueDate: document.getElementById('evaluationDueDate').value,
                    criteria: criteria
                };
                
                evaluations.push(evaluationData);
                localStorage.setItem('evaluations', JSON.stringify(evaluations));
                
                closeModal('addEvaluationModal');
                Swal.fire({
                    title: 'สร้างสำเร็จ!',
                    text: 'สร้างแบบประเมินเรียบร้อยแล้ว',
                    icon: 'success',
                    timer: 2000,
                    showConfirmButton: false
                });
                
                // Reset form
                document.getElementById('addEvaluationForm').reset();
                resetCriteria();
                
                // Reload page
                loadPage('evaluations');
                
            } catch (error) {
                Swal.fire({
                    title: 'ข้อผิดพลาด!',
                    text: 'เกิดข้อผิดพลาดในการสร้างแบบประเมิน',
                    icon: 'error',
                    confirmButtonColor: '#EF5350'
                });
            }
        });

        // Add grade form handler
        document.getElementById('addGradeForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            try {
                const studentName = document.getElementById('gradeStudentName').value.trim();
                const studentId = document.getElementById('gradeStudentId').value.trim();
                const subjectId = document.getElementById('gradeSubject').value;
                
                if (!studentName || !studentId || !subjectId) {
                    Swal.fire({
                        title: 'ข้อผิดพลาด!',
                        text: 'กรุณากรอกข้อมูลให้ครบถ้วน',
                        icon: 'error',
                        confirmButtonColor: '#EF5350'
                    });
                    return;
                }
                
                const midterm = parseFloat(document.getElementById('gradeMidterm').value) || 0;
                const final = parseFloat(document.getElementById('gradeFinal').value) || 0;
                const assignment = parseFloat(document.getElementById('gradeAssignment').value) || 0;
                const participation = parseFloat(document.getElementById('gradeParticipation').value) || 0;
                
                const totalScore = (midterm * 0.3) + (final * 0.4) + (assignment * 0.2) + (participation * 0.1);
                const grade = calculateGrade(midterm, final, assignment, participation);
                
                const gradeData = {
                    id: Date.now(),
                    studentName: studentName,
                    studentId: studentId,
                    subjectId: parseInt(subjectId),
                    teacherId: currentUser.id,
                    midtermScore: midterm,
                    finalScore: final,
                    assignmentScore: assignment,
                    participationScore: participation,
                    totalScore: Math.round(totalScore * 100) / 100,
                    grade: grade,
                    status: 'pending',
                    note: document.getElementById('gradeNote').value.trim()
                };
                
                grades.push(gradeData);
                localStorage.setItem('grades', JSON.stringify(grades));
                
                closeModal('addGradeModal');
                Swal.fire({
                    title: 'บันทึกสำเร็จ!',
                    text: 'บันทึกผลการเรียนเรียบร้อยแล้ว',
                    icon: 'success',
                    timer: 2000,
                    showConfirmButton: false
                });
                
                // Reset form
                document.getElementById('addGradeForm').reset();
                
                // Reload page
                loadPage('grades');
                
            } catch (error) {
                Swal.fire({
                    title: 'ข้อผิดพลาด!',
                    text: 'เกิดข้อผิดพลาดในการบันทึกผลการเรียน',
                    icon: 'error',
                    confirmButtonColor: '#EF5350'
                });
            }
        });

        // Edit grade form handler
        document.getElementById('editGradeForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            try {
                const gradeId = parseInt(document.getElementById('editGradeId').value);
                const studentName = document.getElementById('editGradeStudentName').value.trim();
                const studentId = document.getElementById('editGradeStudentId').value.trim();
                const subjectId = document.getElementById('editGradeSubject').value;
                
                if (!studentName || !studentId || !subjectId) {
                    Swal.fire({
                        title: 'ข้อผิดพลาด!',
                        text: 'กรุณากรอกข้อมูลให้ครบถ้วน',
                        icon: 'error',
                        confirmButtonColor: '#EF5350'
                    });
                    return;
                }
                
                const midterm = parseFloat(document.getElementById('editGradeMidterm').value) || 0;
                const final = parseFloat(document.getElementById('editGradeFinal').value) || 0;
                const assignment = parseFloat(document.getElementById('editGradeAssignment').value) || 0;
                const participation = parseFloat(document.getElementById('editGradeParticipation').value) || 0;
                
                const totalScore = (midterm * 0.3) + (final * 0.4) + (assignment * 0.2) + (participation * 0.1);
                const grade = calculateGrade(midterm, final, assignment, participation);
                
                // Find and update the grade
                const gradeIndex = grades.findIndex(g => g.id === gradeId);
                if (gradeIndex !== -1) {
                    grades[gradeIndex] = {
                        ...grades[gradeIndex],
                        studentName: studentName,
                        studentId: studentId,
                        subjectId: parseInt(subjectId),
                        midtermScore: midterm,
                        finalScore: final,
                        assignmentScore: assignment,
                        participationScore: participation,
                        totalScore: Math.round(totalScore * 100) / 100,
                        grade: grade,
                        status: 'pending', // Reset status when edited
                        note: document.getElementById('editGradeNote').value.trim()
                    };
                    
                    localStorage.setItem('grades', JSON.stringify(grades));
                    
                    closeModal('editGradeModal');
                    Swal.fire({
                        title: 'แก้ไขสำเร็จ!',
                        text: 'แก้ไขผลการเรียนเรียบร้อยแล้ว',
                        icon: 'success',
                        timer: 2000,
                        showConfirmButton: false
                    });
                    
                    // Reload page
                    loadPage('grades');
                }
                
            } catch (error) {
                Swal.fire({
                    title: 'ข้อผิดพลาด!',
                    text: 'เกิดข้อผิดพลาดในการแก้ไขผลการเรียน',
                    icon: 'error',
                    confirmButtonColor: '#EF5350'
                });
            }
        });

        // Edit school form handler
        document.getElementById('editSchoolForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            try {
                const schoolId = parseInt(document.getElementById('editSchoolId').value);
                const schoolName = document.getElementById('editSchoolName').value.trim();
                const schoolCode = document.getElementById('editSchoolCode').value.trim();
                
                if (!schoolName || !schoolCode) {
                    Swal.fire({
                        title: 'ข้อผิดพลาด!',
                        text: 'กรุณากรอกข้อมูลให้ครบถ้วน',
                        icon: 'error',
                        confirmButtonColor: '#EF5350'
                    });
                    return;
                }
                
                // Find and update the school
                const schoolIndex = schools.findIndex(s => s.id === schoolId);
                if (schoolIndex !== -1) {
                    schools[schoolIndex] = {
                        ...schools[schoolIndex],
                        name: schoolName,
                        code: schoolCode,
                        email: document.getElementById('editSchoolEmail').value.trim(),
                        phone: document.getElementById('editSchoolPhone').value.trim(),
                        address: document.getElementById('editSchoolAddress').value.trim()
                    };
                    
                    localStorage.setItem('schools', JSON.stringify(schools));
                    
                    closeModal('editSchoolModal');
                    Swal.fire({
                        title: 'แก้ไขสำเร็จ!',
                        text: 'แก้ไขข้อมูลโรงเรียนเรียบร้อยแล้ว',
                        icon: 'success',
                        timer: 2000,
                        showConfirmButton: false
                    });
                    
                    // Reload page
                    loadPage('schools');
                }
                
            } catch (error) {
                Swal.fire({
                    title: 'ข้อผิดพลาด!',
                    text: 'เกิดข้อผิดพลาดในการแก้ไขข้อมูลโรงเรียน',
                    icon: 'error',
                    confirmButtonColor: '#EF5350'
                });
            }
        });

        // Settings form handler
        document.addEventListener('DOMContentLoaded', function() {
            // Add event listener for settings form when it's loaded
            document.addEventListener('submit', function(e) {
                if (e.target.id === 'settingsForm') {
                    e.preventDefault();
                    
                    try {
                        const systemName = document.getElementById('systemNameInput').value.trim();
                        
                        if (!systemName) {
                            Swal.fire({
                                title: 'ข้อผิดพลาด!',
                                text: 'กรุณากรอกชื่อระบบ',
                                icon: 'error',
                                confirmButtonColor: '#EF5350'
                            });
                            return;
                        }
                        
                        // Update system settings
                        systemSettings.systemName = systemName;
                        
                        saveSettings();
                        
                        function saveSettings() {
                            localStorage.setItem('systemSettings', JSON.stringify(systemSettings));
                            
                            // Update UI
                            document.getElementById('systemName').textContent = systemSettings.systemName;
                            
                            Swal.fire({
                                title: 'บันทึกสำเร็จ!',
                                text: 'บันทึกการตั้งค่าเรียบร้อยแล้ว',
                                icon: 'success',
                                timer: 2000,
                                showConfirmButton: false
                            });
                            
                            // Reload settings page
                            loadPage('settings');
                        }
                        
                    } catch (error) {
                        Swal.fire({
                            title: 'ข้อผิดพลาด!',
                            text: 'เกิดข้อผิดพลาดในการบันทึกการตั้งค่า',
                            icon: 'error',
                            confirmButtonColor: '#EF5350'
                        });
                    }
                }
            });
        });



        // Reset settings function
        function resetSettings() {
            Swal.fire({
                title: 'ยืนยันการรีเซ็ต',
                text: 'คุณต้องการรีเซ็ตการตั้งค่าเป็นค่าเริ่มต้นหรือไม่?',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#EF5350',
                cancelButtonColor: '#6B7280',
                confirmButtonText: 'รีเซ็ต',
                cancelButtonText: 'ยกเลิก'
            }).then((result) => {
                if (result.isConfirmed) {
                    systemSettings = {
                        systemName: 'ระบบสื่อการสอนและผลการเรียน'
                    };
                    localStorage.setItem('systemSettings', JSON.stringify(systemSettings));
                    
                    // Update UI
                    document.getElementById('systemName').textContent = systemSettings.systemName;
                    
                    Swal.fire({
                        title: 'รีเซ็ตสำเร็จ!',
                        text: 'รีเซ็ตการตั้งค่าเรียบร้อยแล้ว',
                        icon: 'success',
                        timer: 2000,
                        showConfirmButton: false
                    });
                    
                    loadPage('settings');
                }
            });
        }

        // Criteria management functions
        function addCriteria() {
            const container = document.getElementById('criteriaContainer');
            const criteriaItem = document.createElement('div');
            criteriaItem.className = 'criteria-item flex items-center space-x-3 p-3 bg-gray-50 rounded-lg';
            criteriaItem.innerHTML = `
                <input type="text" placeholder="หัวข้อการประเมิน" 
                       class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent criteria-title">
                <input type="number" placeholder="คะแนน" min="1" max="100" 
                       class="w-20 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent criteria-score">
                <button type="button" onclick="removeCriteria(this)" class="text-red-500 hover:text-red-700">
                    <i class="fas fa-trash"></i>
                </button>
            `;
            container.appendChild(criteriaItem);
        }

        function removeCriteria(button) {
            button.closest('.criteria-item').remove();
        }

        function resetCriteria() {
            const container = document.getElementById('criteriaContainer');
            container.innerHTML = `
                <div class="criteria-item flex items-center space-x-3 p-3 bg-gray-50 rounded-lg">
                    <input type="text" placeholder="หัวข้อการประเมิน" 
                           class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent criteria-title">
                    <input type="number" placeholder="คะแนน" min="1" max="100" 
                           class="w-20 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent criteria-score">
                    <button type="button" onclick="removeCriteria(this)" class="text-red-500 hover:text-red-700">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `;
        }

        // Helper functions
        function getTypeColor(type) {
            const colors = {
                'PDF': 'bg-danger',
                'Video': 'bg-primary',
                'PowerPoint': 'bg-warning',
                'Image': 'bg-secondary',
                'Audio': 'bg-info',
                'Link': 'bg-primary'
            };
            return colors[type] || 'bg-gray-500';
        }

        function getEvaluationTypeColor(type) {
            const colors = {
                'quiz': 'bg-primary',
                'assignment': 'bg-secondary',
                'project': 'bg-warning',
                'presentation': 'bg-info',
                'participation': 'bg-danger'
            };
            return colors[type] || 'bg-gray-500';
        }

        function getEvaluationTypeText(type) {
            const texts = {
                'quiz': 'แบบทดสอบ',
                'assignment': 'งานที่มอบหมาย',
                'project': 'โครงงาน',
                'presentation': 'การนำเสนอ',
                'participation': 'การมีส่วนร่วม'
            };
            return texts[type] || type;
        }

        function formatDate(dateString) {
            if (!dateString) return '-';
            const date = new Date(dateString);
            return date.toLocaleDateString('th-TH', {
                year: 'numeric',
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        // Material management functions
        function viewMaterial(materialId) {
            const material = materials.find(m => m.id === materialId);
            if (material && material.url && material.url !== '#') {
                window.open(material.url, '_blank', 'noopener,noreferrer');
            } else {
                Swal.fire({
                    title: 'ไม่พบไฟล์',
                    text: 'ไม่สามารถเปิดไฟล์ได้ หรือยังไม่ได้อัปโหลดไฟล์',
                    icon: 'warning',
                    confirmButtonColor: '#FFCA28'
                });
            }
        }

        function editMaterial(materialId) {
            Swal.fire({
                title: 'ฟีเจอร์นี้กำลังพัฒนา',
                text: 'ขออภัย ฟีเจอร์นี้ยังไม่พร้อมใช้งาน',
                icon: 'info',
                confirmButtonColor: '#26A69A'
            });
        }

        function deleteMaterial(materialId) {
            const material = materials.find(m => m.id === materialId);
            const materialName = material ? material.name : 'สื่อการสอนนี้';
            
            Swal.fire({
                title: 'ยืนยันการลบสื่อการสอน',
                text: `คุณต้องการลบ "${materialName}" หรือไม่?`,
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#EF5350',
                cancelButtonColor: '#6B7280',
                confirmButtonText: 'ลบ',
                cancelButtonText: 'ยกเลิก',
                reverseButtons: true
            }).then((result) => {
                if (result.isConfirmed) {
                    materials = materials.filter(m => m.id !== materialId);
                    localStorage.setItem('materials', JSON.stringify(materials));
                    Swal.fire({
                        title: 'ลบสำเร็จ!',
                        text: 'ลบสื่อการสอนเรียบร้อยแล้ว',
                        icon: 'success',
                        timer: 2000,
                        showConfirmButton: false
                    });
                    loadPage('materials');
                }
            });
        }

        // Evaluation management functions
        function viewEvaluation(evaluationId) {
            const evaluation = evaluations.find(e => e.id === evaluationId);
            if (evaluation) {
                const subject = subjects.find(s => s.id === evaluation.subjectId);
                Swal.fire({
                    title: evaluation.title,
                    html: `
                        <div class="text-left space-y-3">
                            <p><strong>รายวิชา:</strong> ${subject ? subject.name : '-'}</p>
                            <p><strong>ประเภท:</strong> ${getEvaluationTypeText(evaluation.type)}</p>
                            <p><strong>คะแนนเต็ม:</strong> ${evaluation.maxScore} คะแนน</p>
                            <p><strong>น้ำหนัก:</strong> ${evaluation.weight}%</p>
                            <p><strong>กำหนดส่ง:</strong> ${evaluation.dueDate ? formatDate(evaluation.dueDate) : '-'}</p>
                            <p><strong>คำอธิบาย:</strong> ${evaluation.description || '-'}</p>
                            ${evaluation.criteria && evaluation.criteria.length > 0 ? `
                                <div>
                                    <strong>เกณฑ์การประเมิน:</strong>
                                    <ul class="list-disc list-inside mt-2">
                                        ${evaluation.criteria.map(c => `<li>${c.title}: ${c.score} คะแนน</li>`).join('')}
                                    </ul>
                                </div>
                            ` : ''}
                        </div>
                    `,
                    confirmButtonText: 'ปิด',
                    confirmButtonColor: '#26A69A'
                });
            }
        }

        function editEvaluation(evaluationId) {
            showToast('ฟีเจอร์นี้', 'กำลังพัฒนา', 'warning');
        }

        function deleteEvaluation(evaluationId) {
            const evaluation = evaluations.find(e => e.id === evaluationId);
            const evaluationName = evaluation ? evaluation.title : 'แบบประเมินนี้';
            
            Swal.fire({
                title: 'ยืนยันการลบแบบประเมิน',
                text: `คุณต้องการลบ "${evaluationName}" หรือไม่?`,
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#EF5350',
                cancelButtonColor: '#6B7280',
                confirmButtonText: 'ลบ',
                cancelButtonText: 'ยกเลิก',
                reverseButtons: true
            }).then((result) => {
                if (result.isConfirmed) {
                    evaluations = evaluations.filter(e => e.id !== evaluationId);
                    localStorage.setItem('evaluations', JSON.stringify(evaluations));
                    Swal.fire({
                        title: 'ลบสำเร็จ!',
                        text: 'ลบแบบประเมินเรียบร้อยแล้ว',
                        icon: 'success',
                        timer: 2000,
                        showConfirmButton: false
                    });
                    loadPage('evaluations');
                }
            });
        }

        // Grade management functions
        function showAddGradeModal() {
            // Populate subject dropdown
            const gradeSubject = document.getElementById('gradeSubject');
            const teacherSubjects = subjects.filter(s => s.teacherId === currentUser.id);
            
            gradeSubject.innerHTML = '<option value="">เลือกรายวิชา</option>' +
                teacherSubjects.map(subject => `<option value="${subject.id}">${subject.name} (${subject.grade})</option>`).join('');
            
            showModal('addGradeModal');
        }

        function viewGrade(gradeId) {
            const grade = grades.find(g => g.id === gradeId);
            if (grade) {
                const subject = subjects.find(s => s.id === grade.subjectId);
                Swal.fire({
                    title: `ผลการเรียน - ${grade.studentName}`,
                    html: `
                        <div class="text-left space-y-3">
                            <p><strong>รหัสนักเรียน:</strong> ${grade.studentId}</p>
                            <p><strong>รายวิชา:</strong> ${subject ? subject.name : '-'}</p>
                            <p><strong>คะแนนกลางภาค:</strong> ${grade.midtermScore || '-'}</p>
                            <p><strong>คะแนนปลายภาค:</strong> ${grade.finalScore || '-'}</p>
                            <p><strong>คะแนนงาน:</strong> ${grade.assignmentScore || '-'}</p>
                            <p><strong>คะแนนเข้าร่วม:</strong> ${grade.participationScore || '-'}</p>
                            <p><strong>คะแนนรวม:</strong> ${grade.totalScore || '-'}</p>
                            <p><strong>เกรด:</strong> <span class="badge ${getGradeColor(grade.grade)} text-white px-2 py-1 rounded">${grade.grade || '-'}</span></p>
                            <p><strong>สถานะ:</strong> <span class="badge ${grade.status === 'approved' ? 'bg-green-500' : grade.status === 'rejected' ? 'bg-red-500' : 'bg-yellow-500'} text-white px-2 py-1 rounded">${getStatusText(grade.status)}</span></p>
                            ${grade.note ? `<p><strong>หมายเหตุ:</strong> ${grade.note}</p>` : ''}
                        </div>
                    `,
                    confirmButtonText: 'ปิด',
                    confirmButtonColor: '#26A69A'
                });
            }
        }

        function editGrade(gradeId) {
            const grade = grades.find(g => g.id === gradeId);
            if (grade) {
                // Populate subject dropdown
                const editGradeSubject = document.getElementById('editGradeSubject');
                const teacherSubjects = subjects.filter(s => s.teacherId === currentUser.id);
                
                editGradeSubject.innerHTML = '<option value="">เลือกรายวิชา</option>' +
                    teacherSubjects.map(subject => `<option value="${subject.id}">${subject.name} (${subject.grade})</option>`).join('');
                
                // Fill form with existing data
                document.getElementById('editGradeId').value = grade.id;
                document.getElementById('editGradeStudentName').value = grade.studentName;
                document.getElementById('editGradeStudentId').value = grade.studentId;
                document.getElementById('editGradeSubject').value = grade.subjectId;
                document.getElementById('editGradeMidterm').value = grade.midtermScore || '';
                document.getElementById('editGradeFinal').value = grade.finalScore || '';
                document.getElementById('editGradeAssignment').value = grade.assignmentScore || '';
                document.getElementById('editGradeParticipation').value = grade.participationScore || '';
                document.getElementById('editGradeNote').value = grade.note || '';
                
                showModal('editGradeModal');
            }
        }

        function deleteGrade(gradeId) {
            const grade = grades.find(g => g.id === gradeId);
            const studentName = grade ? grade.studentName : 'นักเรียนคนนี้';
            
            Swal.fire({
                title: 'ยืนยันการลบผลการเรียน',
                text: `คุณต้องการลบผลการเรียนของ "${studentName}" หรือไม่?`,
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#EF5350',
                cancelButtonColor: '#6B7280',
                confirmButtonText: 'ลบ',
                cancelButtonText: 'ยกเลิก',
                reverseButtons: true
            }).then((result) => {
                if (result.isConfirmed) {
                    grades = grades.filter(g => g.id !== gradeId);
                    localStorage.setItem('grades', JSON.stringify(grades));
                    Swal.fire({
                        title: 'ลบสำเร็จ!',
                        text: 'ลบผลการเรียนเรียบร้อยแล้ว',
                        icon: 'success',
                        timer: 2000,
                        showConfirmButton: false
                    });
                    loadPage('grades');
                }
            });
        }

        // Helper functions for grades
        function getGradeColor(grade) {
            const colors = {
                'A': 'bg-green-500',
                'B+': 'bg-blue-500',
                'B': 'bg-blue-400',
                'C+': 'bg-yellow-500',
                'C': 'bg-yellow-400',
                'D+': 'bg-orange-500',
                'D': 'bg-orange-400',
                'F': 'bg-red-500'
            };
            return colors[grade] || 'bg-gray-500';
        }

        function getStatusText(status) {
            const texts = {
                'pending': 'รอตรวจสอบ',
                'approved': 'อนุมัติแล้ว',
                'rejected': 'ไม่อนุมัติ'
            };
            return texts[status] || status;
        }

        function calculateGrade(midterm, final, assignment, participation) {
            // Calculate total score (example weights: midterm 30%, final 40%, assignment 20%, participation 10%)
            const total = (midterm * 0.3) + (final * 0.4) + (assignment * 0.2) + (participation * 0.1);
            
            // Determine grade
            if (total >= 80) return 'A';
            if (total >= 75) return 'B+';
            if (total >= 70) return 'B';
            if (total >= 65) return 'C+';
            if (total >= 60) return 'C';
            if (total >= 55) return 'D+';
            if (total >= 50) return 'D';
            return 'F';
        }

        // Director functions
        function viewGradeDetails(gradeId) {
            const grade = grades.find(g => g.id === gradeId);
            if (grade) {
                const subject = subjects.find(s => s.id === grade.subjectId);
                const teacher = users.find(u => u.id === grade.teacherId);
                
                Swal.fire({
                    title: `รายละเอียดผลการเรียน`,
                    html: `
                        <div class="text-left space-y-3">
                            <p><strong>นักเรียน:</strong> ${grade.studentName} (${grade.studentId})</p>
                            <p><strong>รายวิชา:</strong> ${subject ? subject.name : '-'}</p>
                            <p><strong>ครูผู้สอน:</strong> ${teacher ? `${teacher.firstName} ${teacher.lastName}` : '-'}</p>
                            <hr class="my-3">
                            <p><strong>คะแนนกลางภาค:</strong> ${grade.midtermScore || '-'}</p>
                            <p><strong>คะแนนปลายภาค:</strong> ${grade.finalScore || '-'}</p>
                            <p><strong>คะแนนงาน:</strong> ${grade.assignmentScore || '-'}</p>
                            <p><strong>คะแนนเข้าร่วม:</strong> ${grade.participationScore || '-'}</p>
                            <hr class="my-3">
                            <p><strong>คะแนนรวม:</strong> ${grade.totalScore || '-'}</p>
                            <p><strong>เกรด:</strong> <span class="badge ${getGradeColor(grade.grade)} text-white px-2 py-1 rounded">${grade.grade || '-'}</span></p>
                            <p><strong>สถานะ:</strong> <span class="badge ${grade.status === 'approved' ? 'bg-green-500' : grade.status === 'rejected' ? 'bg-red-500' : 'bg-yellow-500'} text-white px-2 py-1 rounded">${getStatusText(grade.status)}</span></p>
                            ${grade.note ? `<p><strong>หมายเหตุ:</strong> ${grade.note}</p>` : ''}
                        </div>
                    `,
                    confirmButtonText: 'ปิด',
                    confirmButtonColor: '#26A69A'
                });
            }
        }

        function approveGrade(gradeId) {
            Swal.fire({
                title: 'ยืนยันการอนุมัติ',
                text: 'คุณต้องการอนุมัติผลการเรียนนี้หรือไม่?',
                icon: 'question',
                showCancelButton: true,
                confirmButtonColor: '#AED581',
                cancelButtonColor: '#6B7280',
                confirmButtonText: 'อนุมัติ',
                cancelButtonText: 'ยกเลิก'
            }).then((result) => {
                if (result.isConfirmed) {
                    const grade = grades.find(g => g.id === gradeId);
                    if (grade) {
                        grade.status = 'approved';
                        localStorage.setItem('grades', JSON.stringify(grades));
                        
                        Swal.fire({
                            title: 'อนุมัติสำเร็จ!',
                            text: 'อนุมัติผลการเรียนเรียบร้อยแล้ว',
                            icon: 'success',
                            timer: 2000,
                            showConfirmButton: false
                        });
                        
                        loadPage('approve-grades');
                    }
                }
            });
        }

        function rejectGrade(gradeId) {
            Swal.fire({
                title: 'ไม่อนุมัติผลการเรียน',
                input: 'textarea',
                inputLabel: 'เหตุผลที่ไม่อนุมัติ',
                inputPlaceholder: 'กรุณาระบุเหตุผล...',
                showCancelButton: true,
                confirmButtonColor: '#EF5350',
                cancelButtonColor: '#6B7280',
                confirmButtonText: 'ไม่อนุมัติ',
                cancelButtonText: 'ยกเลิก',
                inputValidator: (value) => {
                    if (!value) {
                        return 'กรุณาระบุเหตุผล'
                    }
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    const grade = grades.find(g => g.id === gradeId);
                    if (grade) {
                        grade.status = 'rejected';
                        grade.rejectionReason = result.value;
                        localStorage.setItem('grades', JSON.stringify(grades));
                        
                        Swal.fire({
                            title: 'ไม่อนุมัติสำเร็จ!',
                            text: 'ไม่อนุมัติผลการเรียนเรียบร้อยแล้ว',
                            icon: 'success',
                            timer: 2000,
                            showConfirmButton: false
                        });
                        
                        loadPage('approve-grades');
                    }
                }
            });
        }

        function viewTeacherReport(teacherId) {
            const teacher = users.find(u => u.id === teacherId);
            if (teacher) {
                const teacherSubjects = subjects.filter(s => s.teacherId === teacherId);
                const teacherMaterials = materials.filter(m => m.teacherId === teacherId);
                const teacherGrades = grades.filter(g => g.teacherId === teacherId);
                const pendingGrades = teacherGrades.filter(g => g.status === 'pending');
                const approvedGrades = teacherGrades.filter(g => g.status === 'approved');
                
                Swal.fire({
                    title: `รายงานครู: ${teacher.firstName} ${teacher.lastName}`,
                    html: `
                        <div class="text-left space-y-4">
                            <div class="grid grid-cols-2 gap-4">
                                <div class="text-center p-3 bg-blue-50 rounded-lg">
                                    <div class="text-xl font-bold text-blue-600">${teacherSubjects.length}</div>
                                    <div class="text-sm text-blue-600">รายวิชา</div>
                                </div>
                                <div class="text-center p-3 bg-purple-50 rounded-lg">
                                    <div class="text-xl font-bold text-purple-600">${teacherMaterials.length}</div>
                                    <div class="text-sm text-purple-600">สื่อการสอน</div>
                                </div>
                                <div class="text-center p-3 bg-yellow-50 rounded-lg">
                                    <div class="text-xl font-bold text-yellow-600">${pendingGrades.length}</div>
                                    <div class="text-sm text-yellow-600">รอตรวจสอบ</div>
                                </div>
                                <div class="text-center p-3 bg-green-50 rounded-lg">
                                    <div class="text-xl font-bold text-green-600">${approvedGrades.length}</div>
                                    <div class="text-sm text-green-600">อนุมัติแล้ว</div>
                                </div>
                            </div>
                            
                            <div>
                                <h4 class="font-semibold mb-2">รายวิชาที่สอน:</h4>
                                <ul class="list-disc list-inside space-y-1">
                                    ${teacherSubjects.map(s => `<li>${s.name} (${s.grade})</li>`).join('')}
                                </ul>
                            </div>
                            
                            <div>
                                <p><strong>อีเมล:</strong> ${teacher.email || '-'}</p>
                                <p><strong>เบอร์โทรศัพท์:</strong> ${teacher.phone || '-'}</p>
                            </div>
                        </div>
                    `,
                    confirmButtonText: 'ปิด',
                    confirmButtonColor: '#26A69A',
                    width: '600px'
                });
            }
        }

        function approveAllTeacherGrades(teacherId) {
            const teacherGrades = grades.filter(g => g.teacherId === teacherId && g.status === 'pending');
            
            if (teacherGrades.length === 0) {
                Swal.fire({
                    title: 'ไม่มีผลการเรียนที่ต้องอนุมัติ',
                    text: 'ครูคนนี้ไม่มีผลการเรียนที่รอการอนุมัติ',
                    icon: 'info',
                    confirmButtonColor: '#26A69A'
                });
                return;
            }
            
            Swal.fire({
                title: 'ยืนยันการอนุมัติทั้งหมด',
                text: `คุณต้องการอนุมัติผลการเรียนทั้งหมด ${teacherGrades.length} รายการหรือไม่?`,
                icon: 'question',
                showCancelButton: true,
                confirmButtonColor: '#AED581',
                cancelButtonColor: '#6B7280',
                confirmButtonText: 'อนุมัติทั้งหมด',
                cancelButtonText: 'ยกเลิก'
            }).then((result) => {
                if (result.isConfirmed) {
                    teacherGrades.forEach(grade => {
                        grade.status = 'approved';
                    });
                    
                    localStorage.setItem('grades', JSON.stringify(grades));
                    
                    Swal.fire({
                        title: 'อนุมัติสำเร็จ!',
                        text: `อนุมัติผลการเรียนทั้งหมด ${teacherGrades.length} รายการเรียบร้อยแล้ว`,
                        icon: 'success',
                        timer: 2000,
                        showConfirmButton: false
                    });
                    
                    loadPage('approve-reports');
                }
            });
        }

        // Teacher management functions
        function showAddTeacherModal() {
            showModal('addTeacherModal');
        }

        function viewTeacherDetails(teacherId) {
            viewTeacherReport(teacherId);
        }

        function editTeacher(teacherId) {
            const teacher = users.find(u => u.id === teacherId);
            if (teacher) {
                document.getElementById('editTeacherId').value = teacher.id;
                document.getElementById('editTeacherFirstName').value = teacher.firstName;
                document.getElementById('editTeacherLastName').value = teacher.lastName;
                document.getElementById('editTeacherUsername').value = teacher.username;
                document.getElementById('editTeacherEmail').value = teacher.email || '';
                document.getElementById('editTeacherPhone').value = teacher.phone || '';
                
                showModal('editTeacherModal');
            }
        }



        function deleteTeacher(teacherId) {
            const teacher = users.find(u => u.id === teacherId);
            const teacherName = teacher ? `${teacher.firstName} ${teacher.lastName}` : 'ครูคนนี้';
            
            Swal.fire({
                title: 'ยืนยันการลบครู',
                html: `
                    <div class="text-left">
                        <p class="mb-3">คุณต้องการลบครู "<strong>${teacherName}</strong>" หรือไม่?</p>
                        <div class="bg-red-50 border border-red-200 rounded-lg p-3">
                            <p class="text-red-700 text-sm font-medium mb-2">⚠️ การลบจะส่งผลต่อ:</p>
                            <ul class="text-red-600 text-sm list-disc list-inside space-y-1">
                                <li>รายวิชาทั้งหมดของครู</li>
                                <li>สื่อการสอนทั้งหมด</li>
                                <li>ผลการเรียนทั้งหมด</li>
                                <li>ข้อมูลจะถูกลบอย่างถาวร</li>
                            </ul>
                        </div>
                    </div>
                `,
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#EF5350',
                cancelButtonColor: '#6B7280',
                confirmButtonText: 'ลบทั้งหมด',
                cancelButtonText: 'ยกเลิก',
                reverseButtons: true,
                width: '500px'
            }).then((result) => {
                if (result.isConfirmed) {
                    // Remove teacher
                    users = users.filter(u => u.id !== teacherId);
                    
                    // Remove teacher's subjects, materials, and grades
                    subjects = subjects.filter(s => s.teacherId !== teacherId);
                    materials = materials.filter(m => m.teacherId !== teacherId);
                    grades = grades.filter(g => g.teacherId !== teacherId);
                    
                    // Save to localStorage
                    localStorage.setItem('users', JSON.stringify(users));
                    localStorage.setItem('subjects', JSON.stringify(subjects));
                    localStorage.setItem('materials', JSON.stringify(materials));
                    localStorage.setItem('grades', JSON.stringify(grades));
                    
                    Swal.fire({
                        title: 'ลบสำเร็จ!',
                        text: 'ลบครูและข้อมูลที่เกี่ยวข้องเรียบร้อยแล้ว',
                        icon: 'success',
                        timer: 2000,
                        showConfirmButton: false
                    });
                    
                    loadPage('teacher-summary');
                }
            });
        }

        // Add teacher form handler
        document.getElementById('addTeacherForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            try {
                const firstName = document.getElementById('teacherFirstName').value.trim();
                const lastName = document.getElementById('teacherLastName').value.trim();
                const username = document.getElementById('teacherUsername').value.trim();
                const email = document.getElementById('teacherEmail').value.trim();
                const password = document.getElementById('teacherPassword').value;
                const confirmPassword = document.getElementById('teacherConfirmPassword').value;
                
                if (!firstName || !lastName || !username || !email || !password) {
                    Swal.fire({
                        title: 'ข้อผิดพลาด!',
                        text: 'กรุณากรอกข้อมูลให้ครบถ้วน',
                        icon: 'error',
                        confirmButtonColor: '#EF5350'
                    });
                    return;
                }
                
                if (password !== confirmPassword) {
                    Swal.fire({
                        title: 'ข้อผิดพลาด!',
                        text: 'รหัสผ่านไม่ตรงกัน',
                        icon: 'error',
                        confirmButtonColor: '#EF5350'
                    });
                    return;
                }
                
                if (password.length < 6) {
                    Swal.fire({
                        title: 'ข้อผิดพลาด!',
                        text: 'รหัสผ่านต้องมีอย่างน้อย 6 ตัวอักษร',
                        icon: 'error',
                        confirmButtonColor: '#EF5350'
                    });
                    return;
                }
                
                // Check if username already exists
                if (users.find(u => u.username === username)) {
                    Swal.fire({
                        title: 'ข้อผิดพลาด!',
                        text: 'ชื่อผู้ใช้นี้มีอยู่แล้ว',
                        icon: 'error',
                        confirmButtonColor: '#EF5350'
                    });
                    return;
                }
                
                const teacherData = {
                    id: Date.now(),
                    username: username,
                    password: password,
                    role: 'teacher',
                    firstName: firstName,
                    lastName: lastName,
                    email: email,
                    phone: document.getElementById('teacherPhone').value.trim(),
                    schoolId: currentUser.schoolId
                };
                
                users.push(teacherData);
                localStorage.setItem('users', JSON.stringify(users));
                
                closeModal('addTeacherModal');
                Swal.fire({
                    title: 'เพิ่มสำเร็จ!',
                    text: 'เพิ่มครูเรียบร้อยแล้ว',
                    icon: 'success',
                    timer: 2000,
                    showConfirmButton: false
                });
                
                document.getElementById('addTeacherForm').reset();
                loadPage('teacher-summary');
                
            } catch (error) {
                Swal.fire({
                    title: 'ข้อผิดพลาด!',
                    text: 'เกิดข้อผิดพลาดในการเพิ่มครู',
                    icon: 'error',
                    confirmButtonColor: '#EF5350'
                });
            }
        });

        // Edit teacher form handler
        document.getElementById('editTeacherForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            try {
                const teacherId = parseInt(document.getElementById('editTeacherId').value);
                const firstName = document.getElementById('editTeacherFirstName').value.trim();
                const lastName = document.getElementById('editTeacherLastName').value.trim();
                const username = document.getElementById('editTeacherUsername').value.trim();
                const email = document.getElementById('editTeacherEmail').value.trim();
                
                if (!firstName || !lastName || !username || !email) {
                    Swal.fire({
                        title: 'ข้อผิดพลาด!',
                        text: 'กรุณากรอกข้อมูลให้ครบถ้วน',
                        icon: 'error',
                        confirmButtonColor: '#EF5350'
                    });
                    return;
                }
                
                // Check if username already exists (excluding current teacher)
                if (users.find(u => u.username === username && u.id !== teacherId)) {
                    Swal.fire({
                        title: 'ข้อผิดพลาด!',
                        text: 'ชื่อผู้ใช้นี้มีอยู่แล้ว',
                        icon: 'error',
                        confirmButtonColor: '#EF5350'
                    });
                    return;
                }
                
                const teacherIndex = users.findIndex(u => u.id === teacherId);
                if (teacherIndex !== -1) {
                    users[teacherIndex] = {
                        ...users[teacherIndex],
                        firstName: firstName,
                        lastName: lastName,
                        username: username,
                        email: email,
                        phone: document.getElementById('editTeacherPhone').value.trim()
                    };
                    
                    localStorage.setItem('users', JSON.stringify(users));
                    
                    closeModal('editTeacherModal');
                    Swal.fire({
                        title: 'แก้ไขสำเร็จ!',
                        text: 'แก้ไขข้อมูลครูเรียบร้อยแล้ว',
                        icon: 'success',
                        timer: 2000,
                        showConfirmButton: false
                    });
                    
                    loadPage('teacher-summary');
                }
                
            } catch (error) {
                Swal.fire({
                    title: 'ข้อผิดพลาด!',
                    text: 'เกิดข้อผิดพลาดในการแก้ไขข้อมูลครู',
                    icon: 'error',
                    confirmButtonColor: '#EF5350'
                });
            }
        });

        // Academic Year Management Functions
        
        // Add academic year form handler
        document.getElementById('addAcademicYearForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            try {
                const year = document.getElementById('academicYear').value.trim();
                const startDate = document.getElementById('academicStartDate').value;
                const endDate = document.getElementById('academicEndDate').value;
                
                if (!year || !startDate || !endDate) {
                    Swal.fire({
                        title: 'ข้อผิดพลาด!',
                        text: 'กรุณากรอกข้อมูลให้ครบถ้วน',
                        icon: 'error',
                        confirmButtonColor: '#EF5350'
                    });
                    return;
                }
                
                // Check if year already exists
                if (academicYears.find(ay => ay.year === year)) {
                    Swal.fire({
                        title: 'ข้อผิดพลาด!',
                        text: 'ปีการศึกษานี้มีอยู่แล้ว',
                        icon: 'error',
                        confirmButtonColor: '#EF5350'
                    });
                    return;
                }
                
                // Validate dates
                if (new Date(startDate) >= new Date(endDate)) {
                    Swal.fire({
                        title: 'ข้อผิดพลาด!',
                        text: 'วันที่เริ่มต้นต้องมาก่อนวันที่สิ้นสุด',
                        icon: 'error',
                        confirmButtonColor: '#EF5350'
                    });
                    return;
                }
                
                const academicYearData = {
                    id: Date.now(),
                    year: year,
                    startDate: startDate,
                    endDate: endDate,
                    status: 'upcoming',
                    description: document.getElementById('academicDescription').value.trim() || `ปีการศึกษา ${year}`,
                    createdBy: currentUser.id,
                    createdAt: new Date().toISOString(),
                    lastEditedBy: currentUser.id,
                    lastEditedAt: new Date().toISOString()
                };
                
                academicYears.push(academicYearData);
                localStorage.setItem('academicYears', JSON.stringify(academicYears));
                
                closeModal('addAcademicYearModal');
                Swal.fire({
                    title: 'เพิ่มสำเร็จ!',
                    text: 'เพิ่มปีการศึกษาเรียบร้อยแล้ว',
                    icon: 'success',
                    timer: 2000,
                    showConfirmButton: false
                });
                
                document.getElementById('addAcademicYearForm').reset();
                loadPage('academic-years');
                
            } catch (error) {
                Swal.fire({
                    title: 'ข้อผิดพลาด!',
                    text: 'เกิดข้อผิดพลาดในการเพิ่มปีการศึกษา',
                    icon: 'error',
                    confirmButtonColor: '#EF5350'
                });
            }
        });

        // Edit academic year form handler
        document.getElementById('editAcademicYearForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            try {
                const yearId = parseInt(document.getElementById('editAcademicYearId').value);
                const year = document.getElementById('editAcademicYear').value.trim();
                const startDate = document.getElementById('editAcademicStartDate').value;
                const endDate = document.getElementById('editAcademicEndDate').value;
                const status = document.getElementById('editAcademicStatus').value;
                
                if (!year || !startDate || !endDate || !status) {
                    Swal.fire({
                        title: 'ข้อผิดพลาด!',
                        text: 'กรุณากรอกข้อมูลให้ครบถ้วน',
                        icon: 'error',
                        confirmButtonColor: '#EF5350'
                    });
                    return;
                }
                
                // Check if year already exists (excluding current year)
                if (academicYears.find(ay => ay.year === year && ay.id !== yearId)) {
                    Swal.fire({
                        title: 'ข้อผิดพลาด!',
                        text: 'ปีการศึกษานี้มีอยู่แล้ว',
                        icon: 'error',
                        confirmButtonColor: '#EF5350'
                    });
                    return;
                }
                
                // Validate dates
                if (new Date(startDate) >= new Date(endDate)) {
                    Swal.fire({
                        title: 'ข้อผิดพลาด!',
                        text: 'วันที่เริ่มต้นต้องมาก่อนวันที่สิ้นสุด',
                        icon: 'error',
                        confirmButtonColor: '#EF5350'
                    });
                    return;
                }
                
                const yearIndex = academicYears.findIndex(ay => ay.id === yearId);
                if (yearIndex !== -1) {
                    academicYears[yearIndex] = {
                        ...academicYears[yearIndex],
                        year: year,
                        startDate: startDate,
                        endDate: endDate,
                        status: status,
                        description: document.getElementById('editAcademicDescription').value.trim() || `ปีการศึกษา ${year}`,
                        lastEditedBy: currentUser.id,
                        lastEditedAt: new Date().toISOString()
                    };
                    
                    localStorage.setItem('academicYears', JSON.stringify(academicYears));
                    
                    closeModal('editAcademicYearModal');
                    Swal.fire({
                        title: 'แก้ไขสำเร็จ!',
                        text: 'แก้ไขปีการศึกษาเรียบร้อยแล้ว',
                        icon: 'success',
                        timer: 2000,
                        showConfirmButton: false
                    });
                    
                    loadPage('academic-years');
                }
                
            } catch (error) {
                Swal.fire({
                    title: 'ข้อผิดพลาด!',
                    text: 'เกิดข้อผิดพลาดในการแก้ไขปีการศึกษา',
                    icon: 'error',
                    confirmButtonColor: '#EF5350'
                });
            }
        });

        // Edit academic year function
        function editAcademicYear(yearId) {
            const year = academicYears.find(ay => ay.id === yearId);
            if (year) {
                document.getElementById('editAcademicYearId').value = year.id;
                document.getElementById('editAcademicYear').value = year.year;
                document.getElementById('editAcademicStartDate').value = year.startDate;
                document.getElementById('editAcademicEndDate').value = year.endDate;
                document.getElementById('editAcademicStatus').value = year.status;
                document.getElementById('editAcademicDescription').value = year.description || '';
                
                showModal('editAcademicYearModal');
            }
        }

        // Delete academic year function
        function deleteAcademicYear(yearId) {
            const year = academicYears.find(ay => ay.id === yearId);
            const yearName = year ? year.year : 'ปีการศึกษานี้';
            
            // Check if user has permission
            if (currentRole === 'admin') {
                Swal.fire({
                    title: 'ไม่มีสิทธิ์',
                    text: 'ผู้ควบคุมระบบสามารถดูข้อมูลได้เท่านั้น',
                    icon: 'warning',
                    confirmButtonColor: '#FFCA28'
                });
                return;
            }
            
            Swal.fire({
                title: 'ยืนยันการลบปีการศึกษา',
                html: `
                    <div class="text-left">
                        <p class="mb-3">คุณต้องการลบปีการศึกษา "<strong>${yearName}</strong>" หรือไม่?</p>
                        <div class="bg-red-50 border border-red-200 rounded-lg p-3">
                            <p class="text-red-700 text-sm font-medium mb-2">⚠️ หมายเหตุ:</p>
                            <ul class="text-red-600 text-sm list-disc list-inside space-y-1">
                                <li>ไม่สามารถลบปีการศึกษาที่กำลังใช้งานได้</li>
                                <li>การลบจะส่งผลต่อข้อมูลที่เกี่ยวข้อง</li>
                                <li>ข้อมูลจะถูกลบอย่างถาวร</li>
                            </ul>
                        </div>
                    </div>
                `,
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#EF5350',
                cancelButtonColor: '#6B7280',
                confirmButtonText: 'ลบ',
                cancelButtonText: 'ยกเลิก',
                reverseButtons: true,
                width: '500px'
            }).then((result) => {
                if (result.isConfirmed) {
                    academicYears = academicYears.filter(ay => ay.id !== yearId);
                    localStorage.setItem('academicYears', JSON.stringify(academicYears));
                    Swal.fire({
                        title: 'ลบสำเร็จ!',
                        text: 'ลบปีการศึกษาเรียบร้อยแล้ว',
                        icon: 'success',
                        timer: 2000,
                        showConfirmButton: false
                    });
                    loadPage('academic-years');
                }
            });
        }

        // Helper functions for academic years
        function getAcademicStatusColor(status) {
            const colors = {
                'active': 'bg-secondary',
                'completed': 'bg-primary',
                'upcoming': 'bg-warning'
            };
            return colors[status] || 'bg-gray-500';
        }

        function getAcademicStatusText(status) {
            const texts = {
                'active': 'ใช้งาน',
                'completed': 'สิ้นสุดแล้ว',
                'upcoming': 'กำลังจะมาถึง'
            };
            return texts[status] || status;
        }

        function formatDateOnly(dateString) {
            if (!dateString) return '-';
            const date = new Date(dateString);
            return date.toLocaleDateString('th-TH', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });
        }

        function formatDateTime(dateString) {
            if (!dateString) return '-';
            const date = new Date(dateString);
            return date.toLocaleDateString('th-TH', {
                year: 'numeric',
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        // View academic year details function
        function viewAcademicYearDetails(yearId) {
            const year = academicYears.find(ay => ay.id === yearId);
            if (year) {
                const creator = users.find(u => u.id === year.createdBy);
                const editor = users.find(u => u.id === year.lastEditedBy);
                
                Swal.fire({
                    title: `ปีการศึกษา ${year.year}`,
                    html: `
                        <div class="text-left space-y-4">
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <p class="text-sm font-medium text-gray-700">วันที่เริ่มต้น</p>
                                    <p class="text-gray-900">${formatDateOnly(year.startDate)}</p>
                                </div>
                                <div>
                                    <p class="text-sm font-medium text-gray-700">วันที่สิ้นสุด</p>
                                    <p class="text-gray-900">${formatDateOnly(year.endDate)}</p>
                                </div>
                            </div>
                            
                            <div>
                                <p class="text-sm font-medium text-gray-700">สถานะ</p>
                                <span class="badge ${getAcademicStatusColor(year.status)} text-white px-3 py-1 rounded-full">
                                    ${getAcademicStatusText(year.status)}
                                </span>
                            </div>
                            
                            <div>
                                <p class="text-sm font-medium text-gray-700">คำอธิบาย</p>
                                <p class="text-gray-900">${year.description || '-'}</p>
                            </div>
                            
                            <hr class="border-gray-200">
                            
                            <div class="grid grid-cols-1 gap-3">
                                <div>
                                    <p class="text-sm font-medium text-gray-700">ผู้สร้าง</p>
                                    <p class="text-gray-900">${creator ? `${creator.firstName} ${creator.lastName}` : '-'}</p>
                                    <p class="text-xs text-gray-500">${year.createdAt ? formatDateTime(year.createdAt) : '-'}</p>
                                </div>
                                
                                ${year.lastEditedBy && year.lastEditedBy !== year.createdBy ? `
                                    <div>
                                        <p class="text-sm font-medium text-gray-700">แก้ไขล่าสุดโดย</p>
                                        <p class="text-gray-900">${editor ? `${editor.firstName} ${editor.lastName}` : '-'}</p>
                                        <p class="text-xs text-gray-500">${year.lastEditedAt ? formatDateTime(year.lastEditedAt) : '-'}</p>
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                    `,
                    confirmButtonText: 'ปิด',
                    confirmButtonColor: '#26A69A',
                    width: '500px'
                });
            }
        }

        // Announcement Management Functions

        // Get announcements content for admin
        function getAnnouncementsContent() {
            return `
                <div class="bg-white rounded-lg shadow-sm border border-gray-200">
                    <div class="p-6 border-b border-gray-200">
                        <div class="flex justify-between items-center">
                            <div>
                                <h3 class="text-lg font-semibold">จัดการประกาศแจ้งเตือน</h3>
                                <p class="text-sm text-gray-600 mt-1">สร้างและจัดการประกาศสำหรับครูและผู้อำนวยการในแต่ละโรงเรียน</p>
                            </div>
                            <button onclick="showAddAnnouncementModal()" 
                                    class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-opacity-90 transition duration-200">
                                <i class="fas fa-plus mr-2"></i>สร้างประกาศ
                            </button>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">หัวข้อประกาศ</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ประเภท</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ความสำคัญ</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">กลุ่มเป้าหมาย</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">สถานะ</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">วันที่สร้าง</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">การจัดการ</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                ${announcements.length > 0 ? announcements.map(announcement => `
                                    <tr>
                                        <td class="px-6 py-4">
                                            <div class="text-sm font-medium text-gray-900">${announcement.title}</div>
                                            <div class="text-sm text-gray-500 truncate max-w-xs">${announcement.content.substring(0, 100)}${announcement.content.length > 100 ? '...' : ''}</div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span class="badge ${getAnnouncementTypeColor(announcement.type)} text-white">
                                                ${getAnnouncementTypeText(announcement.type)}
                                            </span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span class="badge ${getPriorityColor(announcement.priority)} text-white">
                                                ${getPriorityText(announcement.priority)}
                                            </span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                            ${getTargetAudienceText(announcement.targetAudience, announcement.targetSchools)}
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span class="badge ${announcement.isActive ? 'bg-secondary' : 'bg-gray-500'} text-white">
                                                ${announcement.isActive ? 'เปิดใช้งาน' : 'ปิดใช้งาน'}
                                            </span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                            ${formatDateTime(announcement.createdAt)}
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                            <button onclick="viewAnnouncement(${announcement.id})" 
                                                    class="text-info hover:text-blue-700 mr-3" title="ดูรายละเอียด">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                            <button onclick="editAnnouncement(${announcement.id})" 
                                                    class="text-primary hover:text-primary-dark mr-3" title="แก้ไข">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button onclick="deleteAnnouncement(${announcement.id})" 
                                                    class="text-danger hover:text-red-700" title="ลบ">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </td>
                                    </tr>
                                `).join('') : `
                                    <tr>
                                        <td colspan="7" class="px-6 py-12 text-center text-gray-500">
                                            <i class="fas fa-bullhorn text-4xl mb-4 opacity-20"></i>
                                            <p>ยังไม่มีประกาศ</p>
                                            <p class="text-sm">คลิก "สร้างประกาศ" เพื่อเริ่มต้น</p>
                                        </td>
                                    </tr>
                                `}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }

        // Get view announcements content for teachers and directors
        function getViewAnnouncementsContent() {
            const userSchoolId = currentUser.schoolId;
            const userRole = currentUser.role;
            
            // Filter announcements based on target audience and school
            const relevantAnnouncements = announcements.filter(announcement => {
                if (!announcement.isActive) return false;
                
                // Check target audience
                if (announcement.targetAudience === 'all') return true;
                if (announcement.targetAudience === 'teachers' && userRole === 'teacher') return true;
                if (announcement.targetAudience === 'directors' && userRole === 'director') return true;
                if (announcement.targetAudience === 'specific_schools') {
                    return announcement.targetSchools.includes(userSchoolId);
                }
                
                return false;
            }).sort((a, b) => {
                // Sort by priority (high first) then by date (newest first)
                const priorityOrder = { 'high': 3, 'medium': 2, 'low': 1 };
                if (priorityOrder[a.priority] !== priorityOrder[b.priority]) {
                    return priorityOrder[b.priority] - priorityOrder[a.priority];
                }
                return new Date(b.createdAt) - new Date(a.createdAt);
            });

            return `
                <div class="space-y-6">
                    <!-- Summary Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-600">ประกาศทั้งหมด</p>
                                    <p class="text-2xl font-bold text-primary">${relevantAnnouncements.length}</p>
                                </div>
                                <i class="fas fa-bullhorn text-3xl text-primary opacity-20"></i>
                            </div>
                        </div>
                        <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-600">ยังไม่ได้อ่าน</p>
                                    <p class="text-2xl font-bold text-warning">${relevantAnnouncements.filter(a => !a.readBy.includes(currentUser.id)).length}</p>
                                </div>
                                <i class="fas fa-envelope text-3xl text-warning opacity-20"></i>
                            </div>
                        </div>
                        <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-gray-600">ความสำคัญสูง</p>
                                    <p class="text-2xl font-bold text-danger">${relevantAnnouncements.filter(a => a.priority === 'high').length}</p>
                                </div>
                                <i class="fas fa-exclamation-triangle text-3xl text-danger opacity-20"></i>
                            </div>
                        </div>
                    </div>

                    <!-- Announcements List -->
                    <div class="bg-white rounded-lg shadow-sm border border-gray-200">
                        <div class="p-6 border-b border-gray-200">
                            <h3 class="text-lg font-semibold">ประกาศแจ้งเตือน</h3>
                            <p class="text-sm text-gray-600 mt-1">ประกาศและข่าวสารสำหรับคุณ</p>
                        </div>
                        
                        <div class="divide-y divide-gray-200">
                            ${relevantAnnouncements.length > 0 ? relevantAnnouncements.map(announcement => {
                                const isRead = announcement.readBy.includes(currentUser.id);
                                const creator = users.find(u => u.id === announcement.createdBy);
                                
                                return `
                                    <div class="p-6 hover:bg-gray-50 transition duration-200 ${!isRead ? 'bg-blue-50 border-l-4 border-l-primary' : ''}">
                                        <div class="flex justify-between items-start">
                                            <div class="flex-1">
                                                <div class="flex items-center space-x-3 mb-2">
                                                    <h4 class="text-lg font-medium text-gray-900 ${!isRead ? 'font-semibold' : ''}">${announcement.title}</h4>
                                                    ${!isRead ? '<span class="badge bg-primary text-white text-xs">ใหม่</span>' : ''}
                                                    <span class="badge ${getPriorityColor(announcement.priority)} text-white text-xs">
                                                        ${getPriorityText(announcement.priority)}
                                                    </span>
                                                    <span class="badge ${getAnnouncementTypeColor(announcement.type)} text-white text-xs">
                                                        ${getAnnouncementTypeText(announcement.type)}
                                                    </span>
                                                </div>
                                                
                                                <p class="text-gray-700 mb-3 leading-relaxed">${announcement.content}</p>
                                                
                                                <div class="flex items-center text-sm text-gray-500 space-x-4">
                                                    <span><i class="fas fa-user mr-1"></i>โดย: ${creator ? `${creator.firstName} ${creator.lastName}` : 'ผู้ดูแลระบบ'}</span>
                                                    <span><i class="fas fa-clock mr-1"></i>${formatDateTime(announcement.createdAt)}</span>
                                                </div>
                                            </div>
                                            
                                            <div class="ml-4">
                                                ${!isRead ? `
                                                    <button onclick="markAsRead(${announcement.id})" 
                                                            class="text-primary hover:text-primary-dark" title="ทำเครื่องหมายว่าอ่านแล้ว">
                                                        <i class="fas fa-check-circle"></i>
                                                    </button>
                                                ` : `
                                                    <i class="fas fa-check-circle text-secondary" title="อ่านแล้ว"></i>
                                                `}
                                            </div>
                                        </div>
                                    </div>
                                `;
                            }).join('') : `
                                <div class="p-12 text-center text-gray-500">
                                    <i class="fas fa-inbox text-4xl mb-4 opacity-20"></i>
                                    <p>ไม่มีประกาศสำหรับคุณ</p>
                                </div>
                            `}
                        </div>
                    </div>
                </div>
            `;
        }

        // Show add announcement modal
        function showAddAnnouncementModal() {
            // Populate school checkboxes
            const schoolCheckboxes = document.getElementById('schoolCheckboxes');
            schoolCheckboxes.innerHTML = schools.map(school => `
                <label class="flex items-center space-x-2">
                    <input type="checkbox" value="${school.id}" class="school-checkbox">
                    <span class="text-sm">${school.name} (${school.code})</span>
                </label>
            `).join('');
            
            showModal('addAnnouncementModal');
        }

        // Toggle school selection visibility
        function toggleSchoolSelection() {
            const audience = document.getElementById('announcementAudience').value;
            const schoolDiv = document.getElementById('schoolSelectionDiv');
            
            if (audience === 'specific_schools') {
                schoolDiv.classList.remove('hidden');
            } else {
                schoolDiv.classList.add('hidden');
            }
        }

        // Add announcement form handler
        document.getElementById('addAnnouncementForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            try {
                const title = document.getElementById('announcementTitle').value.trim();
                const content = document.getElementById('announcementContent').value.trim();
                const type = document.getElementById('announcementType').value;
                const priority = document.getElementById('announcementPriority').value;
                const audience = document.getElementById('announcementAudience').value;
                
                if (!title || !content || !type || !priority || !audience) {
                    Swal.fire({
                        title: 'ข้อผิดพลาด!',
                        text: 'กรุณากรอกข้อมูลให้ครบถ้วน',
                        icon: 'error',
                        confirmButtonColor: '#EF5350'
                    });
                    return;
                }
                
                let targetSchools = [];
                if (audience === 'specific_schools') {
                    const checkedSchools = document.querySelectorAll('.school-checkbox:checked');
                    if (checkedSchools.length === 0) {
                        Swal.fire({
                            title: 'ข้อผิดพลาด!',
                            text: 'กรุณาเลือกโรงเรียนอย่างน้อย 1 แห่ง',
                            icon: 'error',
                            confirmButtonColor: '#EF5350'
                        });
                        return;
                    }
                    targetSchools = Array.from(checkedSchools).map(cb => parseInt(cb.value));
                }
                
                const announcementData = {
                    id: Date.now(),
                    title: title,
                    content: content,
                    type: type,
                    priority: priority,
                    targetAudience: audience,
                    targetSchools: targetSchools,
                    createdBy: currentUser.id,
                    createdAt: new Date().toISOString(),
                    isActive: true,
                    readBy: []
                };
                
                announcements.push(announcementData);
                localStorage.setItem('announcements', JSON.stringify(announcements));
                
                closeModal('addAnnouncementModal');
                Swal.fire({
                    title: 'สร้างสำเร็จ!',
                    text: 'สร้างประกาศเรียบร้อยแล้ว',
                    icon: 'success',
                    timer: 2000,
                    showConfirmButton: false
                });
                
                document.getElementById('addAnnouncementForm').reset();
                document.getElementById('schoolSelectionDiv').classList.add('hidden');
                loadPage('announcements');
                
            } catch (error) {
                Swal.fire({
                    title: 'ข้อผิดพลาด!',
                    text: 'เกิดข้อผิดพลาดในการสร้างประกาศ',
                    icon: 'error',
                    confirmButtonColor: '#EF5350'
                });
            }
        });

        // Edit announcement form handler
        document.getElementById('editAnnouncementForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            try {
                const announcementId = parseInt(document.getElementById('editAnnouncementId').value);
                const title = document.getElementById('editAnnouncementTitle').value.trim();
                const content = document.getElementById('editAnnouncementContent').value.trim();
                const type = document.getElementById('editAnnouncementType').value;
                const priority = document.getElementById('editAnnouncementPriority').value;
                const isActive = document.getElementById('editAnnouncementStatus').value === 'true';
                
                if (!title || !content || !type || !priority) {
                    Swal.fire({
                        title: 'ข้อผิดพลาด!',
                        text: 'กรุณากรอกข้อมูลให้ครบถ้วน',
                        icon: 'error',
                        confirmButtonColor: '#EF5350'
                    });
                    return;
                }
                
                const announcementIndex = announcements.findIndex(a => a.id === announcementId);
                if (announcementIndex !== -1) {
                    announcements[announcementIndex] = {
                        ...announcements[announcementIndex],
                        title: title,
                        content: content,
                        type: type,
                        priority: priority,
                        isActive: isActive
                    };
                    
                    localStorage.setItem('announcements', JSON.stringify(announcements));
                    
                    closeModal('editAnnouncementModal');
                    Swal.fire({
                        title: 'แก้ไขสำเร็จ!',
                        text: 'แก้ไขประกาศเรียบร้อยแล้ว',
                        icon: 'success',
                        timer: 2000,
                        showConfirmButton: false
                    });
                    
                    loadPage('announcements');
                }
                
            } catch (error) {
                Swal.fire({
                    title: 'ข้อผิดพลาด!',
                    text: 'เกิดข้อผิดพลาดในการแก้ไขประกาศ',
                    icon: 'error',
                    confirmButtonColor: '#EF5350'
                });
            }
        });

        // View announcement details
        function viewAnnouncement(announcementId) {
            const announcement = announcements.find(a => a.id === announcementId);
            if (announcement) {
                const creator = users.find(u => u.id === announcement.createdBy);
                
                Swal.fire({
                    title: announcement.title,
                    html: `
                        <div class="text-left space-y-4">
                            <div class="flex flex-wrap gap-2 mb-4">
                                <span class="badge ${getAnnouncementTypeColor(announcement.type)} text-white">
                                    ${getAnnouncementTypeText(announcement.type)}
                                </span>
                                <span class="badge ${getPriorityColor(announcement.priority)} text-white">
                                    ${getPriorityText(announcement.priority)}
                                </span>
                                <span class="badge ${announcement.isActive ? 'bg-secondary' : 'bg-gray-500'} text-white">
                                    ${announcement.isActive ? 'เปิดใช้งาน' : 'ปิดใช้งาน'}
                                </span>
                            </div>
                            
                            <div class="bg-gray-50 p-4 rounded-lg">
                                <p class="text-gray-800 leading-relaxed">${announcement.content}</p>
                            </div>
                            
                            <div class="grid grid-cols-2 gap-4 text-sm">
                                <div>
                                    <p class="font-medium text-gray-700">กลุ่มเป้าหมาย:</p>
                                    <p class="text-gray-600">${getTargetAudienceText(announcement.targetAudience, announcement.targetSchools)}</p>
                                </div>
                                <div>
                                    <p class="font-medium text-gray-700">ผู้สร้าง:</p>
                                    <p class="text-gray-600">${creator ? `${creator.firstName} ${creator.lastName}` : 'ผู้ดูแลระบบ'}</p>
                                </div>
                            </div>
                            
                            <div class="text-sm text-gray-500">
                                <p>สร้างเมื่อ: ${formatDateTime(announcement.createdAt)}</p>
                                <p>อ่านแล้ว: ${announcement.readBy.length} คน</p>
                            </div>
                        </div>
                    `,
                    confirmButtonText: 'ปิด',
                    confirmButtonColor: '#26A69A',
                    width: '600px'
                });
            }
        }

        // Edit announcement
        function editAnnouncement(announcementId) {
            const announcement = announcements.find(a => a.id === announcementId);
            if (announcement) {
                document.getElementById('editAnnouncementId').value = announcement.id;
                document.getElementById('editAnnouncementTitle').value = announcement.title;
                document.getElementById('editAnnouncementContent').value = announcement.content;
                document.getElementById('editAnnouncementType').value = announcement.type;
                document.getElementById('editAnnouncementPriority').value = announcement.priority;
                document.getElementById('editAnnouncementStatus').value = announcement.isActive.toString();
                
                showModal('editAnnouncementModal');
            }
        }

        // Delete announcement
        function deleteAnnouncement(announcementId) {
            const announcement = announcements.find(a => a.id === announcementId);
            const announcementTitle = announcement ? announcement.title : 'ประกาศนี้';
            
            Swal.fire({
                title: 'ยืนยันการลบประกาศ',
                text: `คุณต้องการลบประกาศ "${announcementTitle}" หรือไม่?`,
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#EF5350',
                cancelButtonColor: '#6B7280',
                confirmButtonText: 'ลบ',
                cancelButtonText: 'ยกเลิก',
                reverseButtons: true
            }).then((result) => {
                if (result.isConfirmed) {
                    announcements = announcements.filter(a => a.id !== announcementId);
                    localStorage.setItem('announcements', JSON.stringify(announcements));
                    Swal.fire({
                        title: 'ลบสำเร็จ!',
                        text: 'ลบประกาศเรียบร้อยแล้ว',
                        icon: 'success',
                        timer: 2000,
                        showConfirmButton: false
                    });
                    loadPage('announcements');
                }
            });
        }

        // Mark announcement as read
        function markAsRead(announcementId) {
            const announcement = announcements.find(a => a.id === announcementId);
            if (announcement && !announcement.readBy.includes(currentUser.id)) {
                announcement.readBy.push(currentUser.id);
                localStorage.setItem('announcements', JSON.stringify(announcements));
                loadPage('view-announcements');
            }
        }

        // Helper functions for announcements
        function getAnnouncementTypeColor(type) {
            const colors = {
                'general': 'bg-primary',
                'urgent': 'bg-danger',
                'training': 'bg-info',
                'maintenance': 'bg-warning',
                'policy': 'bg-secondary'
            };
            return colors[type] || 'bg-gray-500';
        }

        function getAnnouncementTypeText(type) {
            const texts = {
                'general': 'ทั่วไป',
                'urgent': 'ด่วน',
                'training': 'การอบรม',
                'maintenance': 'การบำรุงรักษา',
                'policy': 'นโยบาย'
            };
            return texts[type] || type;
        }

        function getPriorityColor(priority) {
            const colors = {
                'high': 'bg-danger',
                'medium': 'bg-warning',
                'low': 'bg-secondary'
            };
            return colors[priority] || 'bg-gray-500';
        }

        function getPriorityText(priority) {
            const texts = {
                'high': 'สูง',
                'medium': 'ปานกลาง',
                'low': 'ต่ำ'
            };
            return texts[priority] || priority;
        }

        function getTargetAudienceText(audience, targetSchools) {
            switch (audience) {
                case 'all':
                    return 'ทุกคน';
                case 'teachers':
                    return 'ครูทั้งหมด';
                case 'directors':
                    return 'ผู้อำนวยการทั้งหมด';
                case 'specific_schools':
                    if (targetSchools && targetSchools.length > 0) {
                        const schoolNames = targetSchools.map(schoolId => {
                            const school = schools.find(s => s.id === schoolId);
                            return school ? school.name : 'ไม่ทราบ';
                        });
                        return schoolNames.length > 2 ? 
                            `${schoolNames.slice(0, 2).join(', ')} และอีก ${schoolNames.length - 2} แห่ง` :
                            schoolNames.join(', ');
                    }
                    return 'โรงเรียนเฉพาะ';
                default:
                    return audience;
            }
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'990f4902a4337322',t:'MTc2MDg2NjUyNS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
